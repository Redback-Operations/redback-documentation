<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-project-4/Crowd-Monitoring/Crowd-Monitoring-Overview" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.6.3">
<title data-rh="true">Crowd-Monitoring-Overview | Redback Operations</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://github.com/redback-documentation/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://github.com/redback-documentation/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://github.com/redback-documentation/docs/project-4/Crowd-Monitoring/Crowd-Monitoring-Overview"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Crowd-Monitoring-Overview | Redback Operations"><meta data-rh="true" name="description" content="Last updated by &#x27;01/09/2024&#x27;"><meta data-rh="true" property="og:description" content="Last updated by &#x27;01/09/2024&#x27;"><link data-rh="true" rel="icon" href="/redback-documentation/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://github.com/redback-documentation/docs/project-4/Crowd-Monitoring/Crowd-Monitoring-Overview"><link data-rh="true" rel="alternate" href="https://github.com/redback-documentation/docs/project-4/Crowd-Monitoring/Crowd-Monitoring-Overview" hreflang="en"><link data-rh="true" rel="alternate" href="https://github.com/redback-documentation/docs/project-4/Crowd-Monitoring/Crowd-Monitoring-Overview" hreflang="x-default"><link rel="stylesheet" href="/redback-documentation/assets/css/styles.24ac416b.css">
<script src="/redback-documentation/assets/js/runtime~main.ad9ebb00.js" defer="defer"></script>
<script src="/redback-documentation/assets/js/main.a5c79969.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/redback-documentation/"><div class="navbar__logo"><img src="/redback-documentation/img/logo.svg" alt="Redback" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/redback-documentation/img/logo.svg" alt="Redback" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Redback</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/redback-documentation/docs/category/onboarding">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/Redback-Operations" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input id="search_input_react" type="search" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/redback-documentation/docs/category/onboarding">Onboarding</a><button aria-label="Expand sidebar category &#x27;Onboarding&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/redback-documentation/docs/category/company-policies">Company Policies</a><button aria-label="Expand sidebar category &#x27;Company Policies&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/redback-documentation/docs/category/project-1">Project 1</a><button aria-label="Expand sidebar category &#x27;Project 1&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/redback-documentation/docs/category/project-2">Project 2</a><button aria-label="Expand sidebar category &#x27;Project 2&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/redback-documentation/docs/category/project-3">Project 3</a><button aria-label="Expand sidebar category &#x27;Project 3&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/redback-documentation/docs/category/project-4">Project 4</a><button aria-label="Collapse sidebar category &#x27;Project 4&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/redback-documentation/docs/category/project-overview">Project Overview</a><button aria-label="Expand sidebar category &#x27;Project Overview&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/redback-documentation/docs/category/crowd-monitoring-overview">Crowd Monitoring Overview</a><button aria-label="Collapse sidebar category &#x27;Crowd Monitoring Overview&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/redback-documentation/docs/project-4/Crowd-Monitoring/Crowd-Monitoring-Overview">Crowd-Monitoring-Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/redback-documentation/docs/project-4/Crowd-Monitoring/MongoDB-Overview">MongoDB-Overview</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/redback-documentation/docs/category/iot-guided-documents">IOT Guided Documents</a><button aria-label="Expand sidebar category &#x27;IOT Guided Documents&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/redback-documentation/docs/category/pose-estimation-overview">Pose estimation Overview</a><button aria-label="Expand sidebar category &#x27;Pose estimation Overview&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/redback-documentation/docs/category/player-tracking-overview">Player-Tracking Overview</a><button aria-label="Expand sidebar category &#x27;Player-Tracking Overview&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/redback-documentation/docs/category/crowd-monitoring-detection-overview">Crowd Monitoring Detection Overview</a><button aria-label="Expand sidebar category &#x27;Crowd Monitoring Detection Overview&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/redback-documentation/docs/category/real-time-data-logistics-processing-and-storage-pipeline">Real-time Data Logistics Processing and Storage Pipeline</a><button aria-label="Expand sidebar category &#x27;Real-time Data Logistics Processing and Storage Pipeline&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/redback-documentation/docs/project-4/Small_Object_Detection/Documentation">Small_Object_Detection</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/redback-documentation/docs/category/project-5">Project 5</a><button aria-label="Expand sidebar category &#x27;Project 5&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/redback-documentation/docs/category/cyber-security-team">Cyber Security Team</a><button aria-label="Expand sidebar category &#x27;Cyber Security Team&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/redback-documentation/docs/category/data-warehousing-team">Data Warehousing Team</a><button aria-label="Expand sidebar category &#x27;Data Warehousing Team&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/redback-documentation/docs/category/web--mobile-app-dev">Web &amp; Mobile App Dev</a><button aria-label="Expand sidebar category &#x27;Web &amp; Mobile App Dev&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/redback-documentation/docs/category/examples--tutorials">Examples / Tutorials</a><button aria-label="Expand sidebar category &#x27;Examples / Tutorials&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/redback-documentation/docs/category/documentation-maintenance">Documentation Maintenance</a><button aria-label="Expand sidebar category &#x27;Documentation Maintenance&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/redback-documentation/docs/orion-backend/kafkadocs/">orion-backend</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/redback-documentation/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/redback-documentation/docs/category/project-4"><span itemprop="name">Project 4</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/redback-documentation/docs/category/crowd-monitoring-overview"><span itemprop="name">Crowd Monitoring Overview</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Crowd-Monitoring-Overview</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><p><strong>Last updated by:</strong> SassafrasAU, <strong>Last updated on:</strong> &#x27;01/09/2024&#x27;</p>
<p><strong>Last updated by:</strong> SassafrasAU, <strong>Last updated on:</strong> &#x27;01/09/2024&#x27;</p>
<header><h1>Crowd Monitoring Overview</h1></header>
<p>The Project Orion aims to apply cutting-edge AI technology to enhance crowd monitoring at various levels. In this semester, we are building on previous efforts to develop an intelligent tracking system, moving from IoT approach to application approach. Our main goal is create a <strong>cloud-based</strong> computer vision pipeline for improved efficiency and faster processing. Later, the application can connect to a database platform and fetching real-time data.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="yolov8">YOLOv8<a href="#yolov8" class="hash-link" aria-label="Direct link to YOLOv8" title="Direct link to YOLOv8">â€‹</a></h2>
<p>Computer Vision (CV) is used in traffic anlysis, automation of manufacturing processed,and human monitoring, which is the essential aspect that we are focusing this semester.</p>
<p><strong>YOLOv8</strong> is a state of the art to monitor and track people in real-time. By combine that with Supervision library, we can detect and track people.</p>
<p><img decoding="async" loading="lazy" alt="YOLOv8 performance" src="/redback-documentation/assets/images/image-b15e3dcfb08da2f41ee09f38dea0c8ba.png" width="3840" height="1440" class="img_ev3q">
Source: <a href="https://docs.ultralytics.com/models/yolov8/" target="_blank" rel="noopener noreferrer">https://docs.ultralytics.com/models/yolov8/</a></p>
<h1>Blue print</h1>
<p>We are focusing to build a pipeline for real-time camera process.</p>
<p>CCTV &gt;&gt; YOLOv8 &gt;&gt; MongoDB &gt;&gt; Website/Dashboard</p>
<h1>Initialize libraries</h1>
<p>This tells you the versions of both PyTorch and CUDA that are installed for <strong>Environment setup</strong>:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#403f53"><span class="token plain">python</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">import torch</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">!nvcc --version</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">TORCH_VERSION = &quot;.&quot;.join(torch.__version__.split(&quot;.&quot;)[:2])</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">CUDA_VERSION = torch.__version__.split(&quot;+&quot;)[-1]</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">print(&quot;torch: &quot;, TORCH_VERSION, &quot;; cuda: &quot;, CUDA_VERSION)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>We will use YOLOv8 in this project:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#403f53"><span class="token plain">python</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">!pip install ultralytics</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">from IPython import display</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">display.clear_output()</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">import ultralytics</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">ultralytics.checks()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Supervision library:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#403f53"><span class="token plain">python</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">!pip install supervision==0.2.0</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">from IPython import display</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">display.clear_output()</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">import supervision as sv</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">print(&quot;supervision&quot;, sv.__version__)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#403f53"><span class="token plain">python</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">import os</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">HOME = os.getcwd()</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">print(HOME)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h1>Testing Crowd Monitoring</h1>
<p>We will use video from Supervision assets - PEOPLE_WALKING</p>
<p><a href="https://media.roboflow.com/supervision/video-examples/people-walking.mp4" target="_blank" rel="noopener noreferrer">https://media.roboflow.com/supervision/video-examples/people-walking.mp4</a></p>
<p><em>After downloaded, you will need to import into to your directory if using on Google Colab.</em></p>
<p><strong>Video testing with YOLOv8 model</strong></p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#403f53"><span class="token plain">python</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"># Importing Libraries</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">from ultralytics import YOLO, solutions</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">from ultralytics.solutions import object_counter</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">import cv2</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">import os</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">import numpy as np</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">from IPython.display import display, Image</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"># Define the video path - Use your own path</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">MARKET_SQUARE_VIDEO_PATH = &quot;/content/people-walking.mp4&quot;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"># Open the video file</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">cap = cv2.VideoCapture(MARKET_SQUARE_VIDEO_PATH)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">assert cap.isOpened(), &quot;Error reading video file&quot;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"># Load the YOLO model</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">model = YOLO(&quot;yolov8n.pt&quot;)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"># Verify the output directory and permissions</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">output_dir = &quot;/content&quot;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">if not os.path.exists(output_dir):</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    os.makedirs(output_dir)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">if not os.access(output_dir, os.W_OK):</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    raise PermissionError(f&quot;Write permission denied for the directory {output_dir}&quot;)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"># Define the output video path</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">output_path = os.path.join(output_dir, &quot;Peoplewalking_v8_29July.mp4&quot;)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"># Reading the Video</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">w, h, fps = (int(cap.get(x)) for x in (cv2.CAP_PROP_FRAME_WIDTH, cv2.CAP_PROP_FRAME_HEIGHT, cv2.CAP_PROP_FPS))</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"># Initialize VideoWriter with a successful FourCC code</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">fourcc_code = cv2.VideoWriter_fourcc(*&quot;mp4v&quot;)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">video_writer = cv2.VideoWriter(output_path, fourcc_code, fps, (w, h))</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">if not video_writer.isOpened():</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    raise IOError(f&quot;Error initializing video writer with path {output_path}&quot;)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"># Assigning the points for Region of Interest</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">region_points = [(20, 1000), (1080, 1000), (1080, 2000), (20, 2000)]</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"># Initialize the ObjectCounter with the model&#x27;s class names</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">counter = solutions.ObjectCounter(</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    view_img=True,</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    reg_pts=region_points,</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    names=model.names,</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    draw_tracks=True,</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    line_thickness=2,</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">while cap.isOpened():</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    success, im0 = cap.read()</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    if not success:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        print(&quot;Video frame is empty or video processing has been successfully completed.&quot;)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        break</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    tracks = model.track(im0, persist=True, show=False, imgsz=1280)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    im0 = counter.start_counting(im0, tracks)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    video_writer.write(im0)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">cap.release()</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">video_writer.release()</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">cv2.destroyAllWindows()</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">print(f&quot;Processed video saved to {output_path}&quot;)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>We have two methods with Camera integration:</p>
<ul>
<li>RTSP url - high latency</li>
<li>Virtue Camera - Camo Studio app - low latency</li>
</ul>
<p><strong>RTSP Camera testing with YOLOv8</strong></p>
<p><strong>Camera testing with YOLOv8</strong></p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#403f53"><span class="token plain">python</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">!pip install opencv-python numpy ultralytics Flask</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#403f53"><span class="token plain">python</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">!pip install &quot;pymongo[srv]&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#403f53"><span class="token plain">python</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">from flask import Flask, Response</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">import cv2</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">import numpy as np</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">from ultralytics import YOLO</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">from pymongo import MongoClient</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">from datetime import datetime, date</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">import time</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">from dotenv import load_dotenv</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">import os</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"># Load YOLO model</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">model = YOLO(&#x27;yolov8n.pt&#x27;)  # or use a different YOLO version</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"># RTSP stream URL</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"># Retrive the RTSP stream URL from iSpy or Wireshark</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"># Replace the rtsp_url with your own RTSP stream URL</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">rtsp_url = &#x27;&#x27;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"># Connect to the RTSP stream</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">cap = cv2.VideoCapture(rtsp_url)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">#MongoDB connection</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">client = MongoClient(&#x27;&#x27;)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">db = client[&quot;CrowdTracking&quot;]</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">collection = db[&quot;Crowd&quot;]</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">#variables for frame_id and date format</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">frame_id = 0</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">current_date = date.today()</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">update_interval = 1 # Update interval in seconds</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">last_update_time = 0</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">while True:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        current_time = time.time()</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        # Read the frame from the stream</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        # If the frame was not read, then break the loop and print an error</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        ret, frame = cap.read()</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        if not ret:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            print(&#x27;Error reading the frame&#x27;)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            break</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        # Perform YOLO detection</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        results = model(frame)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        # Process results with box coordinates and confidence scores</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        for result in results:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            boxes = result.boxes.cpu().numpy()</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            for box in boxes:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                x1, y1, x2, y2 = map(int, box.xyxy[0])</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                conf = box.conf[0]</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                cls = int(box.cls[0])</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                if cls == 0:  # Assuming class 0 is person</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                    cv2.rectangle(frame, (x1, y1), (x2, y2), (0, 255, 0), 2)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                    cv2.putText(frame, f&#x27;Person: {conf:.2f}&#x27;, (x1, y1 - 10),</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                            cv2.FONT_HERSHEY_SIMPLEX, 0.5, (0, 255, 0), 2)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        # This update allows to save the number of persons detected to MongoDB</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        # for every update_interval seconds</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        if current_time - last_update_time &lt; update_interval:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            now = datetime.now()</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            # Save the number of persons detected to MongoDB</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            # Save the frame_id, timestamp and the total number of persons detected</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            data = {</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                &quot;frame_id&quot;: frame_id,</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                &quot;timestamp&quot;: now.strftime(&quot;%d/%m/%Y %H:%M:%S&quot;),</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                &quot;total_persons&quot;: len(boxes)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            collection.insert_one(data)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            last_update_time = current_time</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        # Display the number of persons detected on the frame       </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        cv2.rectangle(frame, (10, 10), (310, 60), (255, 255, 255), -1)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        cv2.putText(frame, f&#x27;Total Persons: {len(boxes)}&#x27;, (20, 40),</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                cv2.FONT_HERSHEY_SIMPLEX, 1, (0, 0, 0), 2)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        frame_id += 1</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        # Display the frame</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        cv2.imshow(&#x27;Crowd Detection&#x27;, frame)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        if cv2.waitKey(1) &amp; 0xFF == ord(&#x27;q&#x27;):</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            break</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">cap.release()</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">cv2.destroyAllWindows()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="result">Result<a href="#result" class="hash-link" aria-label="Direct link to Result" title="Direct link to Result">â€‹</a></h2>
<p><img decoding="async" loading="lazy" alt="Live Camera Tracking" src="/redback-documentation/assets/images/live_camera-da3d806176c64970ab3e053acf147e16.png" width="3382" height="2048" class="img_ev3q"></p>
<h1>Load YOLO model</h1>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#403f53"><span class="token plain">model = YOLO(&#x27;yolov8n.pt&#x27;)  # or use a different YOLO version</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"># RTSP stream URL</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"># Retrive the RTSP stream URL from iSpy or Wireshark</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"># Replace the rtsp_url with your own RTSP stream URL</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">rtsp_url = &#x27;&#x27;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"># Connect to the RTSP stream</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">cap = cv2.VideoCapture(rtsp_url)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">#MongoDB connection</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">client = MongoClient(&#x27;&#x27;)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">db = client[&quot;CrowdTracking&quot;]</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">collection = db[&quot;Crowd&quot;]</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">#variables for frame_id and date format</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">frame_id = 0</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">current_date = date.today()</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">update_interval = 1 # Update interval in seconds</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">last_update_time = 0</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">while True:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        current_time = time.time()</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        # Read the frame from the stream</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        # If the frame was not read, then break the loop and print an error</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        ret, frame = cap.read()</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        if not ret:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            print(&#x27;Error reading the frame&#x27;)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            break</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        # Perform YOLO detection</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        results = model(frame)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        # Process results with box coordinates and confidence scores</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        for result in results:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            boxes = result.boxes.cpu().numpy()</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            for box in boxes:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                x1, y1, x2, y2 = map(int, box.xyxy[0])</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                conf = box.conf[0]</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                cls = int(box.cls[0])</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                if cls == 0:  # Assuming class 0 is person</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                    cv2.rectangle(frame, (x1, y1), (x2, y2), (0, 255, 0), 2)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                    cv2.putText(frame, f&#x27;Person: {conf:.2f}&#x27;, (x1, y1 - 10),</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                            cv2.FONT_HERSHEY_SIMPLEX, 0.5, (0, 255, 0), 2)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        # This update allows to save the number of persons detected to MongoDB</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        # for every update_interval seconds</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        if current_time - last_update_time &lt; update_interval:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            now = datetime.now()</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            # Save the number of persons detected to MongoDB</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            # Save the frame_id, timestamp and the total number of persons detected</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            data = {</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                &quot;frame_id&quot;: frame_id,</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                &quot;timestamp&quot;: now.strftime(&quot;%d/%m/%Y %H:%M:%S&quot;),</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                &quot;total_persons&quot;: len(boxes)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            collection.insert_one(data)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            last_update_time = current_time</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        # Display the number of persons detected on the frame       </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        cv2.rectangle(frame, (10, 10), (310, 60), (255, 255, 255), -1)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        cv2.putText(frame, f&#x27;Total Persons: {len(boxes)}&#x27;, (20, 40),</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                cv2.FONT_HERSHEY_SIMPLEX, 1, (0, 0, 0), 2)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        frame_id += 1</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        # Display the frame</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        cv2.imshow(&#x27;Crowd Detection&#x27;, frame)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        if cv2.waitKey(1) &amp; 0xFF == ord(&#x27;q&#x27;):</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            break</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">cap.release()</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">cv2.destroyAllWindows()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<blockquote>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="result-1">Result<a href="#result-1" class="hash-link" aria-label="Direct link to Result" title="Direct link to Result">â€‹</a></h2>
</blockquote>
<p><img decoding="async" loading="lazy" alt="Live Camera Tracking" src="/redback-documentation/assets/images/live_camera-da3d806176c64970ab3e053acf147e16.png" width="3382" height="2048" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="camo-studio---virtue-camera-on-yolov8">Camo Studio - Virtue Camera on Yolov8<a href="#camo-studio---virtue-camera-on-yolov8" class="hash-link" aria-label="Direct link to Camo Studio - Virtue Camera on Yolov8" title="Direct link to Camo Studio - Virtue Camera on Yolov8">â€‹</a></h2>
<p>We will use Camo Studio app. We will need to download it on your mobile device and PC via App store/Google Play. After setup the app via QR code, we can now use our mobile device as a virtue camera for VS Code.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#403f53"><span class="token plain">python</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">import cv2</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">import numpy as np</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">from ultralytics import YOLO</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">from collections import defaultdict</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">from utils import calculateHomography, transformPoints</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">from pymongo import MongoClient</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">import time as time_module</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">from datetime import datetime</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"># Load the YOLO model</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">model = YOLO(&quot;yolov8n.pt&quot;)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"># Connect to the MongoDB database</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"># and set up data recording</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">client = MongoClient(&quot;&quot;)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">db = client[&quot;Crowd_Monitoring&quot;]</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">collection = db[&quot;Crowd_Count&quot;]</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">lastRecorded = time_module.time()</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"># Connect to the virtue camera using code &quot;1&quot;. Code &quot;0&quot; for webcam</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">rtspUrl = 1</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">cap = cv2.VideoCapture(rtspUrl)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">trackHistory = defaultdict(list)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"># Load the floor image</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">from floorReplica import floorReplica</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">canvasHeight = 1000</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">canvasWidth = 700</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">tilesX = 25</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">tilesY = 15</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">floorImage = floorReplica(canvasHeight, canvasWidth, tilesX, tilesY, rtspUrl)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">height, width, channels = floorImage.shape</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"># Define the codec and create a VideoWriter object</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">fourcc = cv2.VideoWriter_fourcc(*&#x27;mp4v&#x27;)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">video = cv2.VideoWriter(&#x27;output.mp4&#x27;, fourcc, 20.0, (width, height))</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"># Define the source and destination points for the homography matrix</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"># Calculate the homography matrix</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">ptsSRC = np.array([[28, 1158], [2120, 1112], [1840, 488], [350, 518], [468, 1144]])</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">ptsDST = np.array([[0, 990], [699, 988], [693, 658], [0, 661], [141, 988]])</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">homographyMatrix = calculateHomography(ptsSRC, ptsDST)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"># Main loop</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">while True:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">#while cap.isOpened():</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    success, frame = cap.read()</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    results = model.track(frame, persist=True, show=False, imgsz=1280, verbose=True)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    annotatedFrame = floorImage.copy()</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    # Process camera results with box coordinates and confidence scores</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    for result in results:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            boxes_camera = result.boxes.cpu().numpy()</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            for box in boxes_camera:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                x1, y1, x2, y2 = map(int, box.xyxy[0])</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                conf = box.conf[0]</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                cls = int(box.cls[0])</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                if cls == 0:  # Assuming class 0 is person</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                    cv2.rectangle(frame, (x1, y1), (x2, y2), (0, 255, 0), 2)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                    cv2.putText(frame, f&#x27;Person: {conf:.2f}&#x27;, (x1, y1 - 10),</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                            cv2.FONT_HERSHEY_SIMPLEX, 0.5, (0, 255, 0), 2)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    # if results[0].boxes is not None and hasattr(results[0].boxes, &#x27;id&#x27;):</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    try:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        if results[0].boxes is not None:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            # Check if the boxes attribute contains IDs</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            if hasattr(results[0].boxes, &#x27;id&#x27;):</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                # Check if there are any detected boxes</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                if results[0].boxes.id.numel() &gt; 0:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                    # Convert tensor to NumPy array</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                    boxes = results[0].boxes.xywh.cpu().numpy()</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                    trackIDs = results[0].boxes.id.cpu().numpy()</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                    print(&#x27;Track IDs:&#x27;, trackIDs)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                    # Copy floorImage only if objects are detected</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                    annotatedFrame = floorImage.copy()</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                    for trackID in np.unique(trackIDs):</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                        history = trackHistory[trackID]</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                        if len(history) &gt; 1:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                            points = np.array(history, dtype=np.int32)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                            newPoints = transformPoints(points, homographyMatrix)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                            newPoints = newPoints.astype(np.int32)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                            cv2.polylines(annotatedFrame, [newPoints], isClosed=False, color=(0, 0, 255), thickness=2)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                    for box, trackID in zip(boxes, trackIDs):</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                        x, y, w, h = box</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                        center = (int(x), int(y + h / 2))</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                        trackHistory[trackID].append(center)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                        if len(trackHistory[trackID]) &gt; 50:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                            trackHistory[trackID].pop(0)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                    currentTime = time_module.time()</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                    print(currentTime)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                    # Record the number of people in the frame every second</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                    if currentTime - lastRecorded &gt; 1:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                        frameId = int(cap.get(cv2.CAP_PROP_POS_FRAMES))</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                        totalPeople = len(np.unique(trackIDs))</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                        print(&quot;People&quot;, totalPeople)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                        # Convert current time to human-readable format</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                        timestamp = time_module.strftime(&quot;%d-%m-%Y %H:%M:%S&quot;, time_module.localtime(currentTime))</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                        print(timestamp)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                        record = {</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                                &quot;frameId&quot;: frameId,</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                                &quot;timestamp&quot;: timestamp,</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                                &quot;totalPeople&quot;: totalPeople</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                            }</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                        </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                        print(&quot;Before inserting record into MongoDB&quot;)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                        collection.insert_one(record)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                        print(&quot;After inserting record into MongoDB&quot;)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                        lastRecorded = currentTime</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                    print(&quot;People 2&quot;, totalPeople)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                    video.write(annotatedFrame)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                else:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                        print(&quot;No objects detected. No IDs available.&quot;)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            else:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                print(&quot;The &#x27;id&#x27; attribute is not present in the boxes.&quot;)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        else:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                print(&quot;No boxes detected. The &#x27;boxes&#x27; attribute is None.&quot;)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    except AttributeError as e:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                print(f&quot;An AttributeError occurred: {e}&quot;)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    except Exception as e:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                print(f&quot;An unexpected error occurred: {e}&quot;)   </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    cv2.imshow(&quot;Map Tracking&quot;, annotatedFrame)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    cv2.imshow(&quot;Camera Feed&quot;, frame)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    if cv2.waitKey(1) &amp; 0xFF == ord(&#x27;q&#x27;):</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        break</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">cap.release()</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">cv2.destroyAllWindows()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="result-2">Result<a href="#result-2" class="hash-link" aria-label="Direct link to Result" title="Direct link to Result">â€‹</a></h3>
<p><img decoding="async" loading="lazy" alt="Camo demo result" src="/redback-documentation/assets/images/demo-ecf4bfbb354124c347c1da7f3aafabb0.gif" width="768" height="432" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="visualization">Visualization<a href="#visualization" class="hash-link" aria-label="Direct link to Visualization" title="Direct link to Visualization">â€‹</a></h2>
<p>We will need to visualize data to display and analysis on dashboard.</p>
<blockquote>
<p>The idea is fetching the tracking path from processed data, plotting their points from <strong>camera footage</strong> onto <strong>2D floor plan</strong>.</p>
</blockquote>
<p>From that, we can do <strong>flow analysis</strong> and <strong>heatmap</strong> to evaluate crowd density.</p>
<p>This is a powerful information. It will allow you to easily recognize common pattern of congestion at particular times of day or places. Moreover, it can improve your business performance by arranging staffs and products, make inform decisions to drive sales.</p>
<p>Your security camera images are distorted. For example, a one pixel movement at the top of your image corresponds to a much larger movement in the real world than a one pixel movement at the bottom of your image.</p>
<blockquote>
<p>Homography Transformation is the solution for camera mapping.</p>
</blockquote>
<p><img decoding="async" loading="lazy" alt="Homography Transformation" src="/redback-documentation/assets/images/image-1-393c61fea90fa9628c8995e3f479d9e9.png" width="1244" height="530" class="img_ev3q">
<img decoding="async" loading="lazy" alt="Homography Transformation" src="/redback-documentation/assets/images/image-2-bf21c11ef9bafc24005a0081a43d4728.png" width="1234" height="474" class="img_ev3q">
Source: <a href="https://zbigatron.com/mapping-camera-coordinates-to-a-2d-floor-plan/" target="_blank" rel="noopener noreferrer">https://zbigatron.com/mapping-camera-coordinates-to-a-2d-floor-plan/</a></p>
<p>We need to calculate corresponse mapping matrix H for homography transformation. We can create the matrix by choosing pixel coordinates in camera view and corresponding pixel coordinates in matching image (at least 4 points).</p>
<blockquote>
<p>Use matrix H to performed track points transformation to plot path on map 2D floor plane.</p>
</blockquote>
<p><img decoding="async" loading="lazy" alt="Matrix Transformation" src="/redback-documentation/assets/images/image-3-432759eec5f3249b070260c8dca5fdb7.png" width="1238" height="498" class="img_ev3q"></p>
<p><strong>TESTING</strong></p>
<p>Fetching and draw track path of camera view</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#403f53"><span class="token plain">python</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">import cv2</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">import numpy as np</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">from ultralytics import YOLO</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">from collections import defaultdict</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"># Initialize YOLO model</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">model = YOLO(&quot;yolov8n.pt&quot;)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"># Open video file</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">video_path = &quot;/content/people-walking.mp4&quot;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">cap = cv2.VideoCapture(video_path)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"># Initialize track history</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">track_history = defaultdict(list)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"># Initialize video writer (optional, if you want to save the output)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">fourcc = cv2.VideoWriter_fourcc(*&quot;mp4v&quot;)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">video_writer = cv2.VideoWriter(&#x27;/content/tracking_white_output.mp4&#x27;, fourcc, 20.0, (int(cap.get(3)), int(cap.get(4))))</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"># Assigning the points for Region of Interest</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">region_points = [(20, 500), (1080, 500), (1080, 1000), (20, 1000)]</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"># Initialize the ObjectCounter with the model&#x27;s class names</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"># Init Object Counter</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">counter = solutions.ObjectCounter(</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    view_img=True,</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    view_in_counts	= True,</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    view_out_counts	= True,</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    reg_pts=region_points,</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    names=model.names,</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    #draw_tracks=True,</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    line_thickness=2,</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">while cap.isOpened():</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    success, frame = cap.read()</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    if not success:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        break</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    # Get the frame dimensions</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    height, width, channels = frame.shape</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    # Create a white frame of the same size</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    white_frame = np.ones((height, width, channels), dtype=np.uint8) * 255</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    # Track objects in the frame</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    results = model.track(frame, persist=True, show=False, imgsz=1280, verbose=True)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    # Extract tracking results</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    boxes = results[0].boxes.xywh.cpu().numpy()</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    track_ids = results[0].boxes.id.int().cpu().numpy()</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    # Draw paths for each track</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    #frame_with_counting = counter.start_counting(frame, results)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    #annotated_frame = frame_with_counting.copy()  # Make a copy of the frame to draw paths on</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    annotated_frame = white_frame  # Make a copy of the frame to draw paths on</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    for track_id in np.unique(track_ids):</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        # Get the history for this track_id</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        history = track_history[track_id]</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        if len(history) &gt; 1:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            points = np.array(history, dtype=np.int32)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            # Draw the path (line connecting the points)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            cv2.polylines(annotated_frame, [points], isClosed=False, color=(0, 255, 0), thickness=2)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    # Update the track history with new positions</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    for box, track_id in zip(boxes, track_ids):</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        x, y, w, h = box</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        center = (int(x), int(y + h / 2))</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        track_history[track_id].append(center)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        # Limit history length</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        if len(track_history[track_id]) &gt; 50:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            track_history[track_id].pop(0)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    # Save or display the frame</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    video_writer.write(annotated_frame)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"># Release resources</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">cap.release()</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">video_writer.release()</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">cv2.destroyAllWindows()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Draw floor plan</strong></p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#403f53"><span class="token plain">python</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">from google.colab.patches import cv2_imshow</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">import numpy as np</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">def create_floor_replica(canvas_height, canvas_width, num_tiles_x, num_tiles_y):</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    &quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    Create a floor replica with a white canvas and rectangular tiles.</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    Parameters:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    canvas_height (int): Height of the canvas.</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    canvas_width (int): Width of the canvas.</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    num_tiles_x (int): Number of tiles horizontally.</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    num_tiles_y (int): Number of tiles vertically.</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    Returns:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    floor_image (numpy.ndarray): The generated floor image with tiles.</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    &quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    # Calculate the height of each tile</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    tile_height = canvas_height // num_tiles_y</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    # Calculate the width of each tile</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    tile_width = canvas_width // num_tiles_x</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    # Create a white canvas</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    floor_image = np.ones((canvas_height, canvas_width, 3), dtype=np.uint8) * 255</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    # Draw the tiles (rectangles)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    for y in range(0, canvas_height, tile_height):</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        for x in range(0, canvas_width, tile_width):</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            cv2.rectangle(floor_image, (x, y), (x + tile_width, y + tile_height), (0, 0, 0), 1)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    return floor_image</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"># Example usage</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">if __name__ == &quot;__main__&quot;:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    # Define the canvas size (height and width)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    canvas_height = 1000  # Example height</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    canvas_width = 700  # Example width</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    # Number of tiles horizontally and vertically</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    num_tiles_x = 25</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    num_tiles_y = 15</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    # Create the floor replica</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    floor_image = create_floor_replica(canvas_height, canvas_width, num_tiles_x, num_tiles_y)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    # Display the result</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    cv2_imshow(floor_image)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    cv2.imwrite(&#x27;/content/floor_replica.png&#x27;, floor_image)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    cv2.waitKey(0)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    cv2.destroyAllWindows()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Perform transformation and draw tracking path on floor plan</strong></p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#403f53"><span class="token plain">python</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">import cv2</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">import numpy as np</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">from ultralytics import YOLO</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">from collections import defaultdict</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"># Initialize YOLO model</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">model = YOLO(&quot;yolov8n.pt&quot;)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"># Open video file</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">video_path = &quot;/content/people-walking.mp4&quot;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">cap = cv2.VideoCapture(video_path)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"># Initialize track history</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">track_history = defaultdict(list)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"># Load the base image</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">base_image_path = &#x27;/content/floor_replica.png&#x27;</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">floor_frame = cv2.imread(base_image_path)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"># Ensure the base image is loaded</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">if floor_frame is None:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    raise ValueError(f&quot;Could not load the base image from {base_image_path}&quot;)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"># Get the dimensions of the base image</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">height, width, channels = floor_frame.shape</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"># Initialize video writer with the dimensions of the base image</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">fourcc = cv2.VideoWriter_fourcc(*&quot;mp4v&quot;)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">video_writer = cv2.VideoWriter(&#x27;/content/2D_map_output.mp4&#x27;, fourcc, 20.0, (width, height))</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"># Matching points from 2 views</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"># Provide points from image 1</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">pts_src = np.array([[28, 1158], [2120, 1112], [1840, 488], [350, 518], [468, 1144]])</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"># Corresponding points from image 2</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">pts_dst = np.array([[0, 990], [699, 988], [693, 658], [0, 661], [141, 988]])</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"># Define homography functions</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">def calculate_homography(pts_src, pts_dst):</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    return cv2.findHomography(pts_src, pts_dst)[0]</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">def transform_points(points, homography_matrix):</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    points = np.concatenate([points, np.ones((points.shape[0], 1))], axis=1)  # Add a column of ones for homogenous coordinates</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    transformed_points = homography_matrix.dot(points.T).T  # Apply homography</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    transformed_points /= transformed_points[:, 2][:, np.newaxis]  # Normalize by the third coordinate</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    return transformed_points[:, :2]</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"># Calculate the homography matrix once, since pts_src and pts_dst are constant</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">homography_matrix = calculate_homography(pts_src, pts_dst)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"># Process each frame</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">while cap.isOpened():</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    success, frame = cap.read()</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    if not success:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        break</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    # Track objects in the frame</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    results = model.track(frame, persist=True, show=False, imgsz=1280, verbose=True)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    # Extract tracking results</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    boxes = results[0].boxes.xywh.cpu().numpy()</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    track_ids = results[0].boxes.id.int().cpu().numpy()</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    # Use a fresh copy of the base image</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    annotated_frame = floor_frame.copy()</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    for track_id in np.unique(track_ids):</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        # Get the history for this track_id</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        history = track_history[track_id]</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        if len(history) &gt; 1:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            points = np.array(history, dtype=np.int32)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            # Transform the points using the precomputed homography matrix</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            new_points = transform_points(points, homography_matrix)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            new_points = new_points.astype(np.int32)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            # Draw the path (line connecting the points)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            cv2.polylines(annotated_frame, [new_points], isClosed=False, color=(0, 255, 0), thickness=2)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    # Update the track history with new positions</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    for box, track_id in zip(boxes, track_ids):</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        x, y, w, h = box</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        center = (int(x), int(y + h / 2))</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        track_history[track_id].append(center)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        # Limit history length</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">        if len(track_history[track_id]) &gt; 50:</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">            track_history[track_id].pop(0)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    # Save the annotated frame to the video</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    video_writer.write(annotated_frame)</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"># Release resources</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">cap.release()</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">video_writer.release()</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">cv2.destroyAllWindows()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="results">Results<a href="#results" class="hash-link" aria-label="Direct link to Results" title="Direct link to Results">â€‹</a></h2>
<p><img decoding="async" loading="lazy" alt="Transformation result" src="/redback-documentation/assets/images/gif-99f42379c96dfb20fe528a52a0d13972.gif" width="1152" height="648" class="img_ev3q"></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/Redback-Operations/redback-documentation/blob/main/docs/project-4/Crowd-Monitoring/Crowd-Monitoring-Overview.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/redback-documentation/docs/category/crowd-monitoring-overview"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Crowd Monitoring Overview</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/redback-documentation/docs/project-4/Crowd-Monitoring/MongoDB-Overview"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">MongoDB-Overview</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#yolov8" class="table-of-contents__link toc-highlight">YOLOv8</a></li><li><a href="#result" class="table-of-contents__link toc-highlight">Result</a></li><li><a href="#result-1" class="table-of-contents__link toc-highlight">Result</a></li><li><a href="#camo-studio---virtue-camera-on-yolov8" class="table-of-contents__link toc-highlight">Camo Studio - Virtue Camera on Yolov8</a><ul><li><a href="#result-2" class="table-of-contents__link toc-highlight">Result</a></li></ul></li><li><a href="#visualization" class="table-of-contents__link toc-highlight">Visualization</a></li><li><a href="#results" class="table-of-contents__link toc-highlight">Results</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Info</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/redback-documentation/docs/category/onboarding">Docs</a></li><li class="footer__item"><a href="https://github.com/Redback-Operations" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2025 Redback Operations</div></div></div></footer></div>
</body>
</html>