<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-project-1/iot/ble-connectivity/BLE-Auto-Connect-Script" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.6.3">
<title data-rh="true">BLE-Auto-Connect-Script | Redback Operations</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://github.com/redback-documentation/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://github.com/redback-documentation/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://github.com/redback-documentation/docs/project-1/iot/ble-connectivity/BLE-Auto-Connect-Script"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="BLE-Auto-Connect-Script | Redback Operations"><meta data-rh="true" name="description" content="Last updated by &#x27;23/09/2024&#x27;"><meta data-rh="true" property="og:description" content="Last updated by &#x27;23/09/2024&#x27;"><link data-rh="true" rel="icon" href="/redback-documentation/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://github.com/redback-documentation/docs/project-1/iot/ble-connectivity/BLE-Auto-Connect-Script"><link data-rh="true" rel="alternate" href="https://github.com/redback-documentation/docs/project-1/iot/ble-connectivity/BLE-Auto-Connect-Script" hreflang="en"><link data-rh="true" rel="alternate" href="https://github.com/redback-documentation/docs/project-1/iot/ble-connectivity/BLE-Auto-Connect-Script" hreflang="x-default"><link rel="stylesheet" href="/redback-documentation/assets/css/styles.24ac416b.css">
<script src="/redback-documentation/assets/js/runtime~main.ad9ebb00.js" defer="defer"></script>
<script src="/redback-documentation/assets/js/main.a5c79969.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/redback-documentation/"><div class="navbar__logo"><img src="/redback-documentation/img/logo.svg" alt="Redback" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/redback-documentation/img/logo.svg" alt="Redback" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Redback</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/redback-documentation/docs/category/onboarding">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/Redback-Operations" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input id="search_input_react" type="search" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/redback-documentation/docs/category/onboarding">Onboarding</a><button aria-label="Expand sidebar category &#x27;Onboarding&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/redback-documentation/docs/category/company-policies">Company Policies</a><button aria-label="Expand sidebar category &#x27;Company Policies&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/redback-documentation/docs/category/project-1">Project 1</a><button aria-label="Collapse sidebar category &#x27;Project 1&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/redback-documentation/docs/category/vr">VR</a><button aria-label="Expand sidebar category &#x27;VR&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/redback-documentation/docs/category/iot">IoT</a><button aria-label="Collapse sidebar category &#x27;IoT&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/redback-documentation/docs/category/introduction">Introduction</a><button aria-label="Expand sidebar category &#x27;Introduction&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/redback-documentation/docs/category/operation">Operation</a><button aria-label="Expand sidebar category &#x27;Operation&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/redback-documentation/docs/category/technical-background-information">Technical Background Information</a><button aria-label="Expand sidebar category &#x27;Technical Background Information&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/redback-documentation/docs/category/codebase-documentation">Codebase Documentation</a><button aria-label="Expand sidebar category &#x27;Codebase Documentation&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/redback-documentation/docs/project-1/iot/MQTTtoSerialCommunication_Markdown">MQTTtoSerialCommunication_Markdown</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/redback-documentation/docs/category/ble-connectivity">BLE Connectivity</a><button aria-label="Collapse sidebar category &#x27;BLE Connectivity&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/redback-documentation/docs/project-1/iot/ble-connectivity/BLE-Auto-Connect-Script">BLE-Auto-Connect-Script</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/redback-documentation/docs/project-1/iot/ble-connectivity/BLEConnectivityFix">BLEConnectivityFix</a></li></ul></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/redback-documentation/docs/category/project-2">Project 2</a><button aria-label="Expand sidebar category &#x27;Project 2&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/redback-documentation/docs/category/project-3">Project 3</a><button aria-label="Expand sidebar category &#x27;Project 3&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/redback-documentation/docs/category/project-4">Project 4</a><button aria-label="Expand sidebar category &#x27;Project 4&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/redback-documentation/docs/category/project-5">Project 5</a><button aria-label="Expand sidebar category &#x27;Project 5&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/redback-documentation/docs/category/cyber-security-team">Cyber Security Team</a><button aria-label="Expand sidebar category &#x27;Cyber Security Team&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/redback-documentation/docs/category/data-warehousing-team">Data Warehousing Team</a><button aria-label="Expand sidebar category &#x27;Data Warehousing Team&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/redback-documentation/docs/category/web--mobile-app-dev">Web &amp; Mobile App Dev</a><button aria-label="Expand sidebar category &#x27;Web &amp; Mobile App Dev&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/redback-documentation/docs/category/examples--tutorials">Examples / Tutorials</a><button aria-label="Expand sidebar category &#x27;Examples / Tutorials&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/redback-documentation/docs/category/documentation-maintenance">Documentation Maintenance</a><button aria-label="Expand sidebar category &#x27;Documentation Maintenance&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/redback-documentation/docs/orion-backend/kafkadocs/">orion-backend</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/redback-documentation/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/redback-documentation/docs/category/project-1"><span itemprop="name">Project 1</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/redback-documentation/docs/category/iot"><span itemprop="name">IoT</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/redback-documentation/docs/category/ble-connectivity"><span itemprop="name">BLE Connectivity</span></a><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">BLE-Auto-Connect-Script</span><meta itemprop="position" content="4"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><p><strong>Last updated by:</strong> KasparByrne, <strong>Last updated on:</strong> &#x27;23/09/2024&#x27;</p>
<p><strong>Last updated by:</strong> KasparByrne, <strong>Last updated on:</strong> &#x27;23/09/2024&#x27;</p>
<header><h1>BLE Auto Connecting Script</h1></header>
<p><img decoding="async" loading="lazy" alt="image" src="/redback-documentation/assets/images/bike-architecture-ffc42871fa4f0068d2ce823d52d33c4d.png" width="335" height="626" class="img_ev3q"></p>
<p>Script location: <a href="https://github.com/Redback-Operations/redback-smartbike-iot/tree/main/scripts/ble-auto-connect" target="_blank" rel="noopener noreferrer">scripts/ble-auto-connect/</a></p>
<p>This script was created to handle persistent BLE issues we had with the bike. Connecting to the bike was not consistent, with failed pairing on start up and even manually connecting using the <code>bluetoothctl</code> interface on the Raspberry Pi not working consistently. This script should resolve these issues by using <code>bluetoothctl</code> and <code>expect</code> script to act like a user and automatically resolve the BLE connection.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="starting-the-script">Starting the Script<a href="#starting-the-script" class="hash-link" aria-label="Direct link to Starting the Script" title="Direct link to Starting the Script">​</a></h2>
<p>To start this script run the following command from the home directory:</p>
<p><code>bash iot/scripts/ble-auto-connect/ble_auto_connect.sh</code></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="script-requirements">Script Requirements<a href="#script-requirements" class="hash-link" aria-label="Direct link to Script Requirements" title="Direct link to Script Requirements">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="expect-installed">Expect Installed<a href="#expect-installed" class="hash-link" aria-label="Direct link to Expect Installed" title="Direct link to Expect Installed">​</a></h3>
<p>Ensure <code>expect</code> is installed using:</p>
<p><code>sudo apt-get install expect</code></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="kickr-mac-address">KICKR MAC Address<a href="#kickr-mac-address" class="hash-link" aria-label="Direct link to KICKR MAC Address" title="Direct link to KICKR MAC Address">​</a></h3>
<p>The KICKR&#x27;s MAC address must be accurately stored in the hidden <code>.env</code> file, in the home directory, with the following format:</p>
<p><code>... KICKR_MAC_ADDRESS=&quot;XX:XX:XX:XX:XX:XX&quot; ...</code></p>
<p><em>To access the hidden environment file use <code>nano .env</code> in the home directory</em></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="bike-not-on-standby">Bike NOT on Standby<a href="#bike-not-on-standby" class="hash-link" aria-label="Direct link to Bike NOT on Standby" title="Direct link to Bike NOT on Standby">​</a></h3>
<p>Ensure that the bike is not on standby: the BLE indicator light on the KICKR is blinking blue and not off</p>
<p><img decoding="async" loading="lazy" alt="image" src="/redback-documentation/assets/images/kickr-connected-d8cc5700bfe38630d30e7fb60e9bb602.jpg" width="307" height="408" class="img_ev3q"></p>
<p><em>KICKR BLE indicator light located above ANT+ indicator light</em></p>
<p>If it is on standby rotate the pedals a few times.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="expected-process-behaviour">Expected Process Behaviour<a href="#expected-process-behaviour" class="hash-link" aria-label="Direct link to Expected Process Behaviour" title="Direct link to Expected Process Behaviour">​</a></h2>
<p>The script follows a simple flow of commands reacting to expected outputs to terminal from <code>bluetoothctl</code> commands and writing input commands into the terminal.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="once-started">Once Started<a href="#once-started" class="hash-link" aria-label="Direct link to Once Started" title="Direct link to Once Started">​</a></h3>
<p>Once the script has been started, it enters commands into the terminal interface like a user, waiting for expected output from commands and responding to resolve any issues.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#403f53"><span class="token plain">Agent registered</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">[bluetooth]# default-agent</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">Default agent request successful</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">[bluetooth]# connect d9:07:e8:1c:db:94</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">Attempting to connect to d9:07:e8:1c:db:94</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">[CHG] Device D9:07:E8:1C:DB:94 Connected: yes</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">Failed to connect: org.bluez.Error.Failed</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">[CHG] Device D9:07:E8:1C:DB:94 Connected: no</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">[bluetooth]# connect d9:07:e8:1c:db:94</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">Attempting to connect to d9:07:e8:1c:db:94</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">[CHG] Device D9:07:E8:1C:DB:94 Connected: yes</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">Connection successful</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">[Wahoo KICKR 58CB]# exit</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>DO NOT</strong> attempt to enter anything into command-line during this process - if you must, terminate the script using <code>Ctrl + C</code> before doing so.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="ble-scanning">BLE Scanning<a href="#ble-scanning" class="hash-link" aria-label="Direct link to BLE Scanning" title="Direct link to BLE Scanning">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#403f53"><span class="token plain">[CHG] Controller B8:27:EB:DB:48:17 Discovering: yes</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">[NEW] Device CB:81:82:06:8A:F8 HEADWIND AF28</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">[NEW] Device E4:8F:3B:BB:66:82 E4-8F-3B-BB-66-82</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">[NEW] Device F2:93:DE:57:0C:2C F2-93-DE-57-0C-2C</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">[CHG] Device D9:07:E8:1C:DB:94 RSSI: -45</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">[CHG] Device D9:07:E8:1C:DB:94 UUIDs: 00001818-0000-1000-8000-00805f9b34fb</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">[CHG] Device D9:07:E8:1C:DB:94 UUIDs: 00001826-0000-1000-8000-00805f9b34fb</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">[NEW] Device C1:44:45:FD:29:12 C1-44-45-FD-29-12</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">[NEW] Device 47:0B:B1:7F:C4:E6 47-0B-B1-7F-C4-E6</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">[NEW] Device D7:C1:4A:AF:BF:C1 D7-C1-4A-AF-BF-C1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If the KICKR has not been registered by <code>bluetoothctl</code> then the script will automatically initiate a scan for all local BLE devices yielding a spam of output like above. This output should only last a few seconds at most a minute.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="script-completion">Script Completion<a href="#script-completion" class="hash-link" aria-label="Direct link to Script Completion" title="Direct link to Script Completion">​</a></h3>
<p>If a connection was successfully achieved, an output to the terminal should indicate so:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#403f53;background-color:#FBFBFB"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#403f53"><span class="token plain">Connection established with bike via BLE</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>And the BLE indicator light on the KICKR should become solid:</p>
<p><img decoding="async" loading="lazy" alt="image" src="/redback-documentation/assets/images/kickr-connected-d8cc5700bfe38630d30e7fb60e9bb602.jpg" width="307" height="408" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="script-failure">Script Failure<a href="#script-failure" class="hash-link" aria-label="Direct link to Script Failure" title="Direct link to Script Failure">​</a></h3>
<p>The above process should only take a few seconds to a minute but can fail for unknown reasons and enter into a loop. If this happens, use <code>Ctrl + C</code> to terminate the script and then restart both the bike &amp; Pi, and re-run the script.</p>
<p>If this does not fix the issue then refer to the <a href="/redback-documentation/docs/project-1/iot/ble-connectivity/BLEConnectivityFix">BLEConnectivityFix</a> document to connect manually.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="future">Future<a href="#future" class="hash-link" aria-label="Direct link to Future" title="Direct link to Future">​</a></h2>
<p>Some improvements to the script are desireable and left for future team members to implement:</p>
<ul>
<li>Running the script on Pi start up using a daemon to fully automate the connection</li>
<li>Running the script on script start up (<code>start_all.sh</code>) so that BLE connection is always resolved before other processes initialise</li>
<li>Running the script in a background process so that it does not interfer with the command-line</li>
<li>Forever looping the script so that it will reconnect if the connection drops for some reason</li>
<li>Extend script to handle any future encountered issues</li>
<li>Change the regex pattern used to match the KICKR MAC address to be more forgiving</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="resources">Resources<a href="#resources" class="hash-link" aria-label="Direct link to Resources" title="Direct link to Resources">​</a></h2>
<ul>
<li><code>bluetoothctl</code> - <a href="https://manpages.debian.org/unstable/bluez/bluetoothctl.1.en.html" target="_blank" rel="noopener noreferrer">https://manpages.debian.org/unstable/bluez/bluetoothctl.1.en.html</a></li>
<li><code>expect</code> introduction - <a href="https://phoenixnap.com/kb/linux-expect" target="_blank" rel="noopener noreferrer">https://phoenixnap.com/kb/linux-expect</a></li>
<li>Reading files using <code>tcl</code> (the backbone of <code>expect</code>) - <a href="https://wiki.tcl-lang.org/page/How+do+I+read+and+write+files+in+Tcl" target="_blank" rel="noopener noreferrer">https://wiki.tcl-lang.org/page/How+do+I+read+and+write+files+in+Tcl</a></li>
<li>Bash script &amp; expect script located in <a href="https://github.com/Redback-Operations/redback-smartbike-iot/tree/main/scripts/ble-auto-connect" target="_blank" rel="noopener noreferrer">scripts/ble-auto-connect/</a></li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/Redback-Operations/redback-documentation/blob/main/docs/project-1/iot/ble-connectivity/BLE-Auto-Connect-Script.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/redback-documentation/docs/category/ble-connectivity"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">BLE Connectivity</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/redback-documentation/docs/project-1/iot/ble-connectivity/BLEConnectivityFix"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">BLEConnectivityFix</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#starting-the-script" class="table-of-contents__link toc-highlight">Starting the Script</a></li><li><a href="#script-requirements" class="table-of-contents__link toc-highlight">Script Requirements</a><ul><li><a href="#expect-installed" class="table-of-contents__link toc-highlight">Expect Installed</a></li><li><a href="#kickr-mac-address" class="table-of-contents__link toc-highlight">KICKR MAC Address</a></li><li><a href="#bike-not-on-standby" class="table-of-contents__link toc-highlight">Bike NOT on Standby</a></li></ul></li><li><a href="#expected-process-behaviour" class="table-of-contents__link toc-highlight">Expected Process Behaviour</a><ul><li><a href="#once-started" class="table-of-contents__link toc-highlight">Once Started</a></li><li><a href="#ble-scanning" class="table-of-contents__link toc-highlight">BLE Scanning</a></li><li><a href="#script-completion" class="table-of-contents__link toc-highlight">Script Completion</a></li><li><a href="#script-failure" class="table-of-contents__link toc-highlight">Script Failure</a></li></ul></li><li><a href="#future" class="table-of-contents__link toc-highlight">Future</a></li><li><a href="#resources" class="table-of-contents__link toc-highlight">Resources</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Info</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/redback-documentation/docs/category/onboarding">Docs</a></li><li class="footer__item"><a href="https://github.com/Redback-Operations" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Redback Operations</div></div></div></footer></div>
</body>
</html>