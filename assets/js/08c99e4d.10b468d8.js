"use strict";(self.webpackChunkredback_documentation=self.webpackChunkredback_documentation||[]).push([[5093],{1388:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>a,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"cybersecurity/research/nagios/MQTT_Temperature_Plugin_Setup_Guide","title":"MQTT_Temperature_Plugin_Setup_Guide","description":"Last updated by \'22/09/2024\'","source":"@site/docs/cybersecurity/research/nagios/MQTT_Temperature_Plugin_Setup_Guide.md","sourceDirName":"cybersecurity/research/nagios","slug":"/cybersecurity/research/nagios/MQTT_Temperature_Plugin_Setup_Guide","permalink":"/redback-documentation/docs/cybersecurity/research/nagios/MQTT_Temperature_Plugin_Setup_Guide","draft":false,"unlisted":false,"editUrl":"https://github.com/Redback-Operations/redback-documentation/blob/main/docs/cybersecurity/research/nagios/MQTT_Temperature_Plugin_Setup_Guide.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"tutorialSidebar","previous":{"title":"Nagios Implementation","permalink":"/redback-documentation/docs/category/nagios-implementation"},"next":{"title":"Nagios-Report","permalink":"/redback-documentation/docs/cybersecurity/research/nagios/Nagios-Report"}}');var s=i(74848),r=i(28453);const a={sidebar_position:3},o="Redback - MQTT Temperature Plugin in Nagios",c={},l=[{value:"Step 1: Install Required Dependencies",id:"step-1-install-required-dependencies",level:2},{value:"Step 2: Configure <code>commands.cfg</code>",id:"step-2-configure-commandscfg",level:2},{value:"Step 3: Configure <code>localhost.cfg</code>",id:"step-3-configure-localhostcfg",level:2},{value:"Step 4: Configure Alerts and Notifications",id:"step-4-configure-alerts-and-notifications",level:2},{value:"Step 5: Test Notifications",id:"step-5-test-notifications",level:2},{value:"Step 6: Restart Nagios",id:"step-6-restart-nagios",level:2}];function d(e){const n={admonition:"admonition",br:"br",code:"code",h1:"h1",h2:"h2",header:"header",hr:"hr",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Last updated by:"})," yuhanhb, ",(0,s.jsx)(n.strong,{children:"Last updated on:"})," '22/09/2024'"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Last updated by:"})," yuhanhb, ",(0,s.jsx)(n.strong,{children:"Last updated on:"})," '22/09/2024'"]}),"\n",(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"redback---mqtt-temperature-plugin-in-nagios",children:"Redback - MQTT Temperature Plugin in Nagios"})}),"\n",(0,s.jsx)(n.admonition,{type:"important",children:(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Yuhan Bulathsinhalage"}),(0,s.jsx)(n.br,{}),"\n",(0,s.jsx)(n.strong,{children:"Date:"})," 21/09/2024"]})}),"\n",(0,s.jsx)(n.h1,{id:"guide-to-setting-up-mqtt-temperature-plugin-in-nagios",children:"Guide to Setting Up MQTT Temperature Plugin in Nagios"}),"\n",(0,s.jsx)(n.p,{children:"This guide will help you integrate and configure an MQTT temperature plugin in Nagios for real-time monitoring of IoT temperature sensors."}),"\n",(0,s.jsx)(n.h2,{id:"step-1-install-required-dependencies",children:"Step 1: Install Required Dependencies"}),"\n",(0,s.jsx)(n.p,{children:"Before configuring the plugin, ensure that all dependencies are installed on your Nagios server. The MQTT plugin may require Python or other libraries. You can install these dependencies by running the following command:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo apt-get install python3 python3-pip\r\npip3 install paho-mqtt\n"})}),"\n",(0,s.jsxs)(n.h2,{id:"step-2-configure-commandscfg",children:["Step 2: Configure ",(0,s.jsx)(n.code,{children:"commands.cfg"})]}),"\n",(0,s.jsxs)(n.p,{children:["You will need to define the command for the MQTT temperature plugin in the ",(0,s.jsx)(n.code,{children:"commands.cfg"})," file."]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Open the ",(0,s.jsx)(n.code,{children:"commands.cfg"})," file:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo nano /usr/local/nagios/etc/objects/commands.cfg\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Add the following command definition to the file:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"define command {\r\n   command_name check-mqtt_temperature\r\n   command_line /usr/local/nagios/libexec/check-mqtt_temperature.py -H $ARG1$ -t $ARG2$\r\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"This defines the custom command that Nagios will use to check the temperature data from the MQTT broker. Save and exit the file."}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.h2,{id:"step-3-configure-localhostcfg",children:["Step 3: Configure ",(0,s.jsx)(n.code,{children:"localhost.cfg"})]}),"\n",(0,s.jsxs)(n.p,{children:["Next, configure the service in the ",(0,s.jsx)(n.code,{children:"localhost.cfg"})," file to enable monitoring using the temperature plugin."]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Open the ",(0,s.jsx)(n.code,{children:"localhost.cfg"})," file:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo nano /usr/local/nagios/etc/objects/localhost.cfg\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Add the following service definition for the MQTT temperature plugin:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"define service {\r\n   use                   generic-service\r\n   host_name             localhost\r\n   service_description   MQTT Temperature Check\r\n   check_command         check-mqtt_temperature!10.137.0.149!iot/device/temperature\r\n   check_interval        1\r\n   retry_interval        1\r\n   contacts              nagiosadmin\r\n   notifications_enabled 1\r\n   notification_options  w,u,c,r\r\n   notification_interval 60\r\n   notification_period   24x7\r\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"This service will run the MQTT temperature check every minute and notify the admin via email if abnormal conditions are detected."}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"step-4-configure-alerts-and-notifications",children:"Step 4: Configure Alerts and Notifications"}),"\n",(0,s.jsx)(n.p,{children:"To ensure email notifications are sent when a temperature threshold is crossed, configure the email alerts in Nagios."}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Install the necessary mail utilities:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo apt-get install mailutils\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Configure the contact group and contact information:"}),"\n",(0,s.jsxs)(n.p,{children:["Open the ",(0,s.jsx)(n.code,{children:"contacts.cfg"})," file:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo nano /usr/local/nagios/etc/objects/contacts.cfg\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Add the following contact information:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"define contact {\r\n   contact_name            nagiosadmin\r\n   alias                   Nagios Admin\r\n   email                   youremail@email.com\r\n}\r\n\r\ndefine contactgroup {\r\n   contactgroup_name       admins\r\n   alias                   Nagios Administrators\r\n   members                 nagiosadmin\r\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"This configuration defines the recipient for the notification emails."}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"step-5-test-notifications",children:"Step 5: Test Notifications"}),"\n",(0,s.jsx)(n.p,{children:"To verify that email notifications are functioning correctly, manually trigger an alert by simulating an abnormal condition, such as stopping the MQTT service or setting an unrealistic temperature value. Nagios will detect the condition and send an email to the configured address."}),"\n",(0,s.jsx)(n.p,{children:"Check your email inbox to confirm that the alert was received. You should see a message similar to this:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Email notification",src:i(92742).A+"",width:"456",height:"169"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Figure 1: Test E-mail"})}),"\n",(0,s.jsx)(n.h2,{id:"step-6-restart-nagios",children:"Step 6: Restart Nagios"}),"\n",(0,s.jsx)(n.p,{children:"After configuring all necessary files, restart the Nagios service to apply the changes."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo systemctl restart nagios\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.p,{children:"This completes the setup of the MQTT temperature monitoring plugin in Nagios. You can now monitor IoT device temperatures and receive alerts when abnormal conditions are detected."})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},92742:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/email-8cd8a96cc8f44f2fb1967ab41954a87c.png"},28453:(e,n,i)=>{i.d(n,{R:()=>a,x:()=>o});var t=i(96540);const s={},r=t.createContext(s);function a(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);