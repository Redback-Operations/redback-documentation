"use strict";(self.webpackChunkredback_documentation=self.webpackChunkredback_documentation||[]).push([[719],{57097:(e,s,a)=>{a.r(s),a.d(s,{assets:()=>h,contentTitle:()=>d,default:()=>o,frontMatter:()=>r,metadata:()=>n,toc:()=>c});const n=JSON.parse('{"id":"cybersecurity/Blue Team/ids-and-wazuh/wazuh-upgrade/wazuh-agent-upgrade-guide","title":"wazuh-agent-upgrade-guide","description":"Last updated by \'16/05/2025\'","source":"@site/docs/cybersecurity/Blue Team/ids-and-wazuh/wazuh-upgrade/wazuh-agent-upgrade-guide.md","sourceDirName":"cybersecurity/Blue Team/ids-and-wazuh/wazuh-upgrade","slug":"/cybersecurity/Blue Team/ids-and-wazuh/wazuh-upgrade/wazuh-agent-upgrade-guide","permalink":"/redback-documentation/docs/cybersecurity/Blue Team/ids-and-wazuh/wazuh-upgrade/wazuh-agent-upgrade-guide","draft":false,"unlisted":false,"editUrl":"https://github.com/Redback-Operations/redback-documentation/blob/main/docs/cybersecurity/Blue Team/ids-and-wazuh/wazuh-upgrade/wazuh-agent-upgrade-guide.md","tags":[],"version":"current","sidebarPosition":22,"frontMatter":{"sidebar_position":22},"sidebar":"tutorialSidebar","previous":{"title":"wazuh-docker-upgrade-guide","permalink":"/redback-documentation/docs/cybersecurity/Blue Team/ids-and-wazuh/wazuh-upgrade/wazuh-docker-upgrade-guide"},"next":{"title":"Cowrie-Honeypot-Implementation-Guide","permalink":"/redback-documentation/docs/cybersecurity/Blue Team/Cowrie-Honeypot-Implementation-Guide"}}');var t=a(74848),i=a(28453);const r={sidebar_position:22},d="Wazuh Agent Upgrade Guide",h={},c=[{value:"Overview",id:"overview",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Important Note",id:"important-note",level:2},{value:"Upgrade Steps",id:"upgrade-steps",level:2},{value:"Step 1: Install the GPG Key",id:"step-1-install-the-gpg-key",level:3},{value:"Step 2: Add the Wazuh Repository",id:"step-2-add-the-wazuh-repository",level:3},{value:"Step 3: Update Wazuh Agent to the Latest Version",id:"step-3-update-wazuh-agent-to-the-latest-version",level:3},{value:"Step 4: Disable Wazuh Repo (to prevent auto-upgrades)",id:"step-4-disable-wazuh-repo-to-prevent-auto-upgrades",level:3},{value:"Step 5: Restart Wazuh API Services",id:"step-5-restart-wazuh-api-services",level:3},{value:"Step 6: Restart and Validate Running",id:"step-6-restart-and-validate-running",level:3},{value:"Step 7: Post-Upgrade Validation",id:"step-7-post-upgrade-validation",level:3},{value:"Reference",id:"reference",level:2}];function l(e){const s={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Last updated by:"})," bg-11, ",(0,t.jsx)(s.strong,{children:"Last updated on:"})," '16/05/2025'"]}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Last updated by:"})," bg-11, ",(0,t.jsx)(s.strong,{children:"Last updated on:"})," '16/05/2025'"]}),"\n",(0,t.jsx)(s.header,{children:(0,t.jsx)(s.h1,{id:"wazuh-agent-upgrade-guide",children:"Wazuh Agent Upgrade Guide"})}),"\n",(0,t.jsx)(s.admonition,{type:"info",children:(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Document Creation:"})," 05 May, 2025. ",(0,t.jsx)(s.strong,{children:"Last Edited:"})," 05 May, 2025. ",(0,t.jsx)(s.strong,{children:"Authors:"})," Bikendra Gurung.\r\n",(0,t.jsx)("br",{}),(0,t.jsx)(s.strong,{children:"Effective Date:"})," 05 May, 2025. ",(0,t.jsx)(s.strong,{children:"Expiry Date:"})," 05 May, 2026."]})}),"\n",(0,t.jsx)(s.h2,{id:"overview",children:"Overview"}),"\n",(0,t.jsx)(s.p,{children:"This technical guide provides step-by-step instructions on how to safely upgrade the Wazuh Agent to the latest version, ensuring alignment with other Wazuh components \u2013 Dashboard, Indexer, and Manager."}),"\n",(0,t.jsx)(s.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsx)(s.li,{children:"A Wazuh agent installed on the Docker host."}),"\n",(0,t.jsx)(s.li,{children:"Admin/Root access to the Wazuh Docker host (Linux server)."}),"\n",(0,t.jsx)(s.li,{children:"Familiarity with docker, docker-compose, and basic Linux operations."}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"important-note",children:"Important Note"}),"\n",(0,t.jsxs)(s.p,{children:["If the ",(0,t.jsx)(s.code,{children:"docker-compose"})," command does not work on your system, use ",(0,t.jsx)(s.code,{children:"docker compose"})," instead (without a hyphen)."]}),"\n",(0,t.jsx)(s.h2,{id:"upgrade-steps",children:"Upgrade Steps"}),"\n",(0,t.jsx)(s.h3,{id:"step-1-install-the-gpg-key",children:"Step 1: Install the GPG Key"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsx)(s.p,{children:"Download the key"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"curl -O https://packages.wazuh.com/key/GPG-KEY-WAZUH\n"})}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsx)(s.p,{children:"Import the key"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"sudo gpg --no-default-keyring --keyring /usr/share/keyrings/wazuh.gpg --import GPG-KEY-WAZUH\n"})}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsx)(s.p,{children:"Fix permissions"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"sudo chmod 644 /usr/share/keyrings/wazuh.gpg\n"})}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"Install GPG Key",src:a(94235).A+"",width:"1007",height:"175"})}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h3,{id:"step-2-add-the-wazuh-repository",children:"Step 2: Add the Wazuh Repository"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:'echo "deb [signed-by=/usr/share/keyrings/wazuh.gpg] https://packages.wazuh.com/4.x/apt/ stable main" | sudo tee -a /etc/apt/sources.list.d/wazuh.list\n'})}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"Add Wazuh Repo",src:a(75730).A+"",width:"1007",height:"65"})}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h3,{id:"step-3-update-wazuh-agent-to-the-latest-version",children:"Step 3: Update Wazuh Agent to the Latest Version"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"sudo apt-get update\r\nsudo apt-get install wazuh-agent\n"})}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.img,{alt:"Update Wazuh Agent",src:a(21372).A+"",width:"1006",height:"268"}),(0,t.jsx)("br",{}),"\r\n",(0,t.jsx)(s.img,{alt:"Update Wazuh Agent",src:a(32885).A+"",width:"922",height:"386"})]}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h3,{id:"step-4-disable-wazuh-repo-to-prevent-auto-upgrades",children:"Step 4: Disable Wazuh Repo (to prevent auto-upgrades)"}),"\n",(0,t.jsx)(s.p,{children:"After the upgrade, disable the Wazuh repository to avoid undesired upgrades and compatibility issues and ensure version alignment with the Wazuh Manager component."}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:'sudo sed -i "s/^deb/#deb/" /etc/apt/sources.list.d/wazuh.list\r\nsudo apt-get update\n'})}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"Disable Wazuh Repo",src:a(6084).A+"",width:"690",height:"174"})}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h3,{id:"step-5-restart-wazuh-api-services",children:"Step 5: Restart Wazuh API Services"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsx)(s.p,{children:"Access the Wazuh Manager container:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"docker exec -it --user root single-node-wazuh.manager-1 bash\n"})}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"Wazuh Manager Bash",src:a(79163).A+"",width:"720",height:"42"})}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsx)(s.p,{children:"Restart all Wazuh services in Wazuh manager-1:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"/var/ossec/bin/wazuh-control restart\n"})}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"Restart Wazuh Services",src:a(87087).A+"",width:"843",height:"748"})}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsx)(s.p,{children:"Verify the service status:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"/var/ossec/bin/wazuh-control status\n"})}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"Service Status",src:a(56557).A+"",width:"428",height:"327"})}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsx)(s.p,{children:"Review API logs for issues (if necessary):"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"tail -f /var/ossec/logs/ossec.log\n"})}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"API Logs",src:a(2886).A+"",width:"1302",height:"244"})}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h3,{id:"step-6-restart-and-validate-running",children:"Step 6: Restart and Validate Running"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"sudo systemctl restart wazuh-agent\r\nsudo systemctl status wazuh-agent\n"})}),"\n",(0,t.jsx)(s.p,{children:"\u2705 Look for:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:"Active: active (running)\n"})}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"Restart Agent",src:a(98061).A+"",width:"1004",height:"495"})}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h3,{id:"step-7-post-upgrade-validation",children:"Step 7: Post-Upgrade Validation"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsx)(s.li,{children:"Log in to the Wazuh dashboard via a browser."}),"\n",(0,t.jsxs)(s.li,{children:["Navigate to: ",(0,t.jsx)(s.strong,{children:"Agents \u2192 Manage Agents"})]}),"\n",(0,t.jsxs)(s.li,{children:["Confirm the following:","\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"The agent is listed."}),"\n",(0,t.jsxs)(s.li,{children:["The agent status is shown as ",(0,t.jsx)(s.code,{children:"ACTIVE"}),"."]}),"\n",(0,t.jsxs)(s.li,{children:["The version matches the upgraded version (e.g., ",(0,t.jsx)(s.code,{children:"4.11.2"}),")."]}),"\n"]}),"\n",(0,t.jsx)(s.img,{alt:"Verify Upgrade",src:a(97335).A+"",width:"1600",height:"595"})]}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"\u2705 This confirms a successful upgrade and validates registration, version alignment, and heartbeat communication with the Wazuh Manager."}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h2,{id:"reference",children:"Reference"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"https://documentation.wazuh.com/current/upgrade-guide/wazuh-agent/linux.html",children:"https://documentation.wazuh.com/current/upgrade-guide/wazuh-agent/linux.html"})}),"\n"]})]})}function o(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},98061:(e,s,a)=>{a.d(s,{A:()=>n});const n=a.p+"assets/images/10_restart-wazuh-validate-running-c88da4cb26554d973d61fd1d0941d065.jpg"},97335:(e,s,a)=>{a.d(s,{A:()=>n});const n=a.p+"assets/images/11_verify-wazuh-successful-upgrade-7d0daca6756b82bab2ec5ccbec263f02.jpg"},94235:(e,s,a)=>{a.d(s,{A:()=>n});const n=a.p+"assets/images/1_install-gpg-key-cef68760221bb60ca957f14540d8577d.jpg"},75730:(e,s,a)=>{a.d(s,{A:()=>n});const n=a.p+"assets/images/2_add-wazuh-repo-9d041650348c414a11e3ef7a90069152.jpg"},21372:(e,s,a)=>{a.d(s,{A:()=>n});const n=a.p+"assets/images/3_update-waazuh-agent-latest-version-63283957181ee9dc190499ba8e15d612.jpg"},32885:(e,s,a)=>{a.d(s,{A:()=>n});const n=a.p+"assets/images/4_update-waazuh-agent-latest-version-3ffe806a110c88e6ad40178c6e063555.jpg"},6084:(e,s,a)=>{a.d(s,{A:()=>n});const n=a.p+"assets/images/5_disable-wazuh-repo-566bd08c94fdf190ae48c2c289effe77.jpg"},79163:(e,s,a)=>{a.d(s,{A:()=>n});const n=a.p+"assets/images/6_wazuh-manager-bash-5eeeab445b3a4929683831efcc094a01.jpg"},87087:(e,s,a)=>{a.d(s,{A:()=>n});const n=a.p+"assets/images/7_wazuh-manager-services-restart-82a26bf5ab7e03e9091f86378264407f.jpg"},56557:(e,s,a)=>{a.d(s,{A:()=>n});const n=a.p+"assets/images/8_wazuh-manager-services-status-70f3e8e816389a851dd9b289dc74b0b6.jpg"},2886:(e,s,a)=>{a.d(s,{A:()=>n});const n=a.p+"assets/images/9_check-api-logs-6505d8f32ab58f058e3b9838142ca609.jpg"},28453:(e,s,a)=>{a.d(s,{R:()=>r,x:()=>d});var n=a(96540);const t={},i=n.createContext(t);function r(e){const s=n.useContext(i);return n.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function d(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),n.createElement(i.Provider,{value:s},e.children)}}}]);