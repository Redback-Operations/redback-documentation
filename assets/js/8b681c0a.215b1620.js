"use strict";(self.webpackChunkredback_documentation=self.webpackChunkredback_documentation||[]).push([[3698],{42427:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>t,default:()=>h,frontMatter:()=>l,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"data-warehousing/Instructional Documents/VM Crash and next steps","title":"VM Crash and next steps","description":"Last updated by \'14/05/2025\'","source":"@site/docs/data-warehousing/Instructional Documents/VM Crash and next steps.md","sourceDirName":"data-warehousing/Instructional Documents","slug":"/data-warehousing/Instructional Documents/VM Crash and next steps","permalink":"/redback-documentation/docs/data-warehousing/Instructional Documents/VM Crash and next steps","draft":false,"unlisted":false,"editUrl":"https://github.com/Redback-Operations/redback-documentation/blob/main/docs/data-warehousing/Instructional Documents/VM Crash and next steps.md","tags":[],"version":"current","sidebarPosition":50,"frontMatter":{"sidebar_position":50},"sidebar":"tutorialSidebar","previous":{"title":"GitHub","permalink":"/redback-documentation/docs/data-warehousing/Instructional Documents/GitHub"},"next":{"title":"Next Steps","permalink":"/redback-documentation/docs/data-warehousing/Instructional Documents/Next Steps"}}');var i=s(74848),a=s(28453);const l={sidebar_position:50},t="After-Action Report: Data Warehouse Crash and Recovery (April 2025)",o={},d=[{value:"Summary",id:"summary",level:2},{value:"Incident Overview",id:"incident-overview",level:2},{value:"Timeline &amp; Root Cause Analysis",id:"timeline--root-cause-analysis",level:2},{value:"Phase 1: User Error",id:"phase-1-user-error",level:3},{value:"Phase 2: Leadership Response",id:"phase-2-leadership-response",level:3},{value:"Phase 3: Secondary Failure - Disk Full",id:"phase-3-secondary-failure---disk-full",level:3},{value:"Phase 4: Mentor Resolution",id:"phase-4-mentor-resolution",level:3},{value:"Phase 5: My Recovery Actions",id:"phase-5-my-recovery-actions",level:3},{value:"Lessons Learned",id:"lessons-learned",level:2},{value:"Technical",id:"technical",level:3},{value:"Team &amp; Leadership",id:"team--leadership",level:3},{value:"Recommendations",id:"recommendations",level:2},{value:"Technical Safeguards",id:"technical-safeguards",level:3},{value:"Training &amp; Awareness",id:"training--awareness",level:3},{value:"Preventive Measures",id:"preventive-measures",level:3},{value:"Conclusion",id:"conclusion",level:2}];function c(e){const n={code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Last updated by:"})," daezel, ",(0,i.jsx)(n.strong,{children:"Last updated on:"})," '14/05/2025'"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Last updated by:"})," daezel, ",(0,i.jsx)(n.strong,{children:"Last updated on:"})," '14/05/2025'"]}),"\n",(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"after-action-report-data-warehouse-crash-and-recovery-april-2025",children:"After-Action Report: Data Warehouse Crash and Recovery (April 2025)"})}),"\n",(0,i.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,i.jsx)(n.p,{children:"This document outlines the events, diagnosis, response, and lessons learned from a critical incident involving the Redback Data Warehouse (DW) VM, where all containers went down and the system became unresponsive due to a combination of user error and a rogue service (Suricata) flooding the disk."}),"\n",(0,i.jsxs)(n.p,{children:["This report serves both as documentation of leadership and technical response, and as a ",(0,i.jsx)(n.strong,{children:"reference for future team members"})," on how to handle similar VM-level issues."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"incident-overview",children:"Incident Overview"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Date of Incident:"})," 15 April 2025"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"VM Services Affected:"})," All core DW services (MinIO, Dremio, File Upload Service, Postgres, etc.)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Initial Trigger:"})," Accidental execution of ",(0,i.jsx)(n.code,{children:"docker rm -f dremio minioserver"})," followed by ",(0,i.jsx)(n.code,{children:"docker compose up -d"})," by a teammate"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Result:"})," Containers restarted incorrectly, data volumes not attached, and later VM became completely unresponsive due to full disk"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"timeline--root-cause-analysis",children:"Timeline & Root Cause Analysis"}),"\n",(0,i.jsx)(n.h3,{id:"phase-1-user-error",children:"Phase 1: User Error"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"A teammate mistakenly believed they were working in an isolated environment and ran the following command:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"docker rm -f dremio minioserver\r\ndocker compose up -d\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Unfortunately, the wrong Docker Compose file (from the Streamlit file upload app) was used, which does ",(0,i.jsx)(n.strong,{children:"not map to the correct persistent volumes"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"As a result, the new containers started without links to the historical data \u2014 making it appear as if data had been lost."}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"phase-2-leadership-response",children:"Phase 2: Leadership Response"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"As the DW leader, I called my mentor Ben Stephens immediately, recognizing the severity of the incident."}),"\n",(0,i.jsx)(n.li,{children:"Ben advised checking whether volumes still existed \u2014 they did."}),"\n",(0,i.jsx)(n.li,{children:"We concluded that the data wasn't lost but rather the current containers weren\u2019t mapped correctly."}),"\n",(0,i.jsx)(n.li,{children:"I attempted to locate and run the correct Docker Compose setup but couldn\u2019t find the core DW folder."}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"phase-3-secondary-failure---disk-full",children:"Phase 3: Secondary Failure - Disk Full"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"While troubleshooting with Sumit (another team lead with data engineering experience), we found:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"docker compose up -d\r\n=> Error: no space left on device\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"VM disk usage was at 100%, preventing any container restarts."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Ben later found the root cause: ",(0,i.jsx)(n.strong,{children:"Suricata service had created 379GB of logs"}),", overwhelming the system."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"phase-4-mentor-resolution",children:"Phase 4: Mentor Resolution"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Ben:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Disabled Suricata using ",(0,i.jsx)(n.code,{children:"systemctl"})]}),"\n",(0,i.jsx)(n.li,{children:"Removed excess logs and files (including 2GB initially without success)"}),"\n",(0,i.jsx)(n.li,{children:"Eventually recovered ~400GB of space"}),"\n",(0,i.jsx)(n.li,{children:"Confirmed it was safe to bring the DW stack back online"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"phase-5-my-recovery-actions",children:"Phase 5: My Recovery Actions"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["I searched for the ",(0,i.jsx)(n.code,{children:".env"})," file required to run the core DW ",(0,i.jsx)(n.code,{children:"docker-compose.yml"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Located it in the ",(0,i.jsx)(n.strong,{children:"previous team leader\u2019s directory"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Once ",(0,i.jsx)(n.code,{children:".env"})," was in place, I ran:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"docker compose --env-file .env up -d\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["All containers restarted successfully, data volumes were reattached, and ",(0,i.jsx)(n.strong,{children:"DW was fully operational again"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"lessons-learned",children:"Lessons Learned"}),"\n",(0,i.jsx)(n.h3,{id:"technical",children:"Technical"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Containers in Docker are not user-isolated by default."})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Running ",(0,i.jsx)(n.code,{children:"docker rm"})," on shared containers can affect everyone."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Volumes are persistent only if correctly mapped."})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Wrong compose file = containers without data."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Disk usage alerts/log rotation for system services"})," should be monitored \u2014 rogue services like Suricata can crash unrelated environments."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"team--leadership",children:"Team & Leadership"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Immediate escalation helped avoid damage."}),"\n",(0,i.jsx)(n.li,{children:"Involving experienced teammates (e.g., Sumit) accelerated recovery."}),"\n",(0,i.jsx)(n.li,{children:"Calm triage under pressure prevented further accidental damage."}),"\n",(0,i.jsx)(n.li,{children:"Mentor involvement at the right moment solved a system-level issue."}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"recommendations",children:"Recommendations"}),"\n",(0,i.jsx)(n.h3,{id:"technical-safeguards",children:"Technical Safeguards"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Use ",(0,i.jsx)(n.strong,{children:"container labels/namespaces"})," or Docker Compose project names to logically separate projects."]}),"\n",(0,i.jsxs)(n.li,{children:["Establish a ",(0,i.jsx)(n.strong,{children:"read-only directory for critical compose files"})," to prevent accidental edits or usage."]}),"\n",(0,i.jsxs)(n.li,{children:["Set up ",(0,i.jsx)(n.strong,{children:"disk usage monitoring"})," with alerts for system-wide usage > 80%."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"training--awareness",children:"Training & Awareness"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Onboard all users with a clear understanding of:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"Shared nature of the VM"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"Which Docker Compose files to use"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"Where persistent volumes are declared and mounted"})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Create a guide on ",(0,i.jsx)(n.strong,{children:'"How to safely run Docker containers in the DW VM"'})]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"preventive-measures",children:"Preventive Measures"}),"\n",(0,i.jsxs)(n.p,{children:["To proactively warn all users about the shared nature of the environment, a system-wide login message was added using the VM\u2019s dynamic MOTD (Message of the Day) system. This banner appears every time a user logs in via SSH and highlights the risk of running destructive Docker commands like ",(0,i.jsx)(n.code,{children:"docker rm -f"}),". This aims to prevent accidental container deletion and reinforces the importance of checking with the Data Warehouse leader before making changes."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Added a disclaimer to critical command guides like:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"DO NOT run `docker rm -f` on shared containers unless confirmed with mentor or DW lead.\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,i.jsx)(n.p,{children:"This incident highlighted the importance of:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Good communication"}),"\n",(0,i.jsx)(n.li,{children:"Team collaboration"}),"\n",(0,i.jsx)(n.li,{children:"Calm leadership"}),"\n",(0,i.jsx)(n.li,{children:"Technical clarity and documentation"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Despite being outside my technical comfort zone, I led the response by:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Immediately escalating to our mentor"}),"\n",(0,i.jsx)(n.li,{children:"Bringing in experienced help"}),"\n",(0,i.jsx)(n.li,{children:"Coordinating a recovery plan"}),"\n",(0,i.jsx)(n.li,{children:"Taking ownership of getting DW back online"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["This documentation ensures that future leaders and contributors ",(0,i.jsx)(n.strong,{children:"do not repeat the same mistakes"})," and can follow a clear recovery path if a similar issue arises again."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.em,{children:"Document prepared by Daezel Goyal, Data Warehouse Leader \u2013 Redback Operations, May 2025"})})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>t});var r=s(96540);const i={},a=r.createContext(i);function l(e){const n=r.useContext(a);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),r.createElement(a.Provider,{value:n},e.children)}}}]);