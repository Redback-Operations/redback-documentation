"use strict";(self.webpackChunkredback_documentation=self.webpackChunkredback_documentation||[]).push([[940],{48922:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"cybersecurity/Blue Team/MISP/Automating_feeds_on_MISP","title":"Automating_feeds_on_MISP","description":"Last updated by \'10/12/2024\'","source":"@site/docs/cybersecurity/Blue Team/MISP/Automating_feeds_on_MISP.md","sourceDirName":"cybersecurity/Blue Team/MISP","slug":"/cybersecurity/Blue Team/MISP/Automating_feeds_on_MISP","permalink":"/redback-documentation/docs/cybersecurity/Blue Team/MISP/Automating_feeds_on_MISP","draft":false,"unlisted":false,"editUrl":"https://github.com/Redback-Operations/redback-documentation/blob/main/docs/cybersecurity/Blue Team/MISP/Automating_feeds_on_MISP.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"MISP_Setup_Guide","permalink":"/redback-documentation/docs/cybersecurity/Blue Team/MISP/MISP_Setup_Guide"},"next":{"title":"Incident Documents","permalink":"/redback-documentation/docs/category/incident-documents"}}');var i=t(74848),o=t(28453);const r={sidebar_position:2},a="Automating Feed Updates in MISP",c={},d=[{value:"1.0 Introduction",id:"10-introduction",level:2},{value:"1.1 Generating an API Key",id:"11-generating-an-api-key",level:2},{value:"1.2 Setting Up a Cron Job",id:"12-setting-up-a-cron-job",level:2},{value:"1.3 Possible troubleshooting Tips",id:"13-possible-troubleshooting-tips",level:2},{value:"1.4 Conclusion",id:"14-conclusion",level:2}];function l(e){const n={admonition:"admonition",br:"br",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",img:"img",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Last updated by:"})," cyber-Elvis, ",(0,i.jsx)(n.strong,{children:"Last updated on:"})," '10/12/2024'"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Last updated by:"})," cyber-Elvis, ",(0,i.jsx)(n.strong,{children:"Last updated on:"})," '10/12/2024'"]}),"\n",(0,i.jsxs)(n.admonition,{type:"info",children:[(0,i.jsx)(n.p,{children:"Document Creation: 2024-12-10. Last Edited: 2024-12-10. Authors: Elvis Nwosu."}),(0,i.jsx)(n.p,{children:"Document Code: MISP-AUTO-FEEDS-V1. Effective Date: 2024-12-10. Expiry Date: 2025-12-10."})]}),"\n",(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"automating-feed-updates-in-misp",children:"Automating Feed Updates in MISP"})}),"\n",(0,i.jsx)(n.h2,{id:"10-introduction",children:"1.0 Introduction"}),"\n",(0,i.jsxs)(n.p,{children:["By default, Feeds in MISP do not automatically update. We\u2019d have to manually go into ",(0,i.jsx)(n.strong,{children:"List Feeds"})," and then ",(0,i.jsx)(n.strong,{children:"Fetch and Store All Feed Data"})," again.",(0,i.jsx)(n.br,{}),"\n","MISP has an internal schedule task feature which can come in handy when automating feed updates, but there are lots of caveats that come with using this feature. It\u2019s recommended to simply create cron jobs."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Screenshot of the MISP schedule task feature with a warning or configuration page.",src:t(96506).A+"",width:"1504",height:"726"})}),"\n",(0,i.jsx)(n.p,{children:"To avoid this, we\u2019ll set up automation using an API call and a cron job."}),"\n",(0,i.jsx)(n.h2,{id:"11-generating-an-api-key",children:"1.1 Generating an API Key"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Navigate to ",(0,i.jsx)(n.strong,{children:"Administration > List Auth Keys"})," in the MISP interface.",(0,i.jsx)(n.br,{}),"\n",(0,i.jsx)(n.img,{alt:"Screenshot showing the navigation to &quot;Administration &gt; List Auth Keys.&quot;",src:t(2818).A+"",width:"1382",height:"910"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Click ",(0,i.jsx)(n.strong,{children:"Add Authentication Key"})," and provide a name (e.g., \u201cAutomation\u201d)."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Set ",(0,i.jsx)(n.strong,{children:"Allowed IP"}),": For this demo, we\u2019re just going to go ahead and set it to ",(0,i.jsx)(n.code,{children:"0.0.0.0/0"}),", which will allow any IP address."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Important"}),": Copy and save the API key securely. Once you select \u2018I\u2019ve noted down my API key,\u2019 you won\u2019t be able to retrieve the API key again."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"12-setting-up-a-cron-job",children:"1.2 Setting Up a Cron Job"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Create a script to call the API using the API key provided with the command below:"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:'bash curl -X POST --insecure --header "Authorization: <API_KEY>" --header "Accept: application/json" --header "Content-Type: application/json" https://<YOUR_MISP_ADDRESS>/feeds/fetchFromAllFeeds'})}),"\n",(0,i.jsxs)(n.ol,{start:"2",children:["\n",(0,i.jsx)(n.li,{children:"Replace <API_KEY> with your actual API key."}),"\n",(0,i.jsx)(n.li,{children:"Make the script executable:"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Screenshot showing the process of adding an authentication key in MISP.",src:t(88750).A+"",width:"1376",height:"614"})}),"\n",(0,i.jsx)(n.p,{children:"Going back to MISP web interface and refresh the jobs page, you\u2019ll notice new feeds are being fetched."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Screenshot of the refreshed jobs page displaying newly fetched feeds.",src:t(81672).A+"",width:"1248",height:"1029"})}),"\n",(0,i.jsx)(n.p,{children:"Now we proceed to assign a cronjob with the following line of code."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.em,{children:"crontab -e."})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Screenshot showing the cron job setup interface or process.",src:t(17070).A+"",width:"1248",height:"310"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Screenshot showing the command or script execution for updating feeds.",src:t(68030).A+"",width:"1252",height:"492"})}),"\n",(0,i.jsx)(n.p,{children:"Copy and place the same command into the cron job file;"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:'bash curl -X POST --insecure --header "Authorization: \\<API_KEY\\>" --header "Accept: application/json" --header "Content-Type: application/json" https://\\<YOUR_MISP_ADDRESS\\>/feeds/fetchFromAllFeeds'})}),"\n",(0,i.jsx)(n.p,{children:"This cron job will make the API call out to MISP every day in the morning to fetch the latest feeds."}),"\n",(0,i.jsx)(n.h2,{id:"13-possible-troubleshooting-tips",children:"1.3 Possible troubleshooting Tips"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Self-Signed Certificate Issues"}),": Use the ",(0,i.jsx)(n.code,{children:"--insecure"})," flag in curl commands to bypass warnings."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.em,{children:"curl -k ..."})}),"\n",(0,i.jsx)(n.p,{children:"Adding our insecure flag will tell curl to disregard that alert."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"Permission Errors with Docker: Ensure your user is in the docker group:"})}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.em,{children:"sudo usermod -aG docker $USER"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Feed Update Issues: Ensure the API key has sufficient permissions and the cron job is correctly configured."}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"14-conclusion",children:"1.4 Conclusion"}),"\n",(0,i.jsx)(n.p,{children:"MISP is a powerful platform for managing and sharing threat intelligence. By automating feed updates and leveraging its API, you can integrate it into your security operations for enriched threat detection and response."})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},88750:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/add_auth_key-34c015be44f5362a9aa0367afe9b433d.png"},2818:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/auth_keys_navigation-7bdc90a5d6bfa0c05b8d5a966dad7796.png"},17070:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/cron_job_setup-e5c4eefb444e7d5b00061c29ecdac509.png"},68030:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/feed_update_script-d61bfa49b9390d9f38507d55de92a80a.png"},81672:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/jobs_page_refresh-9c4b50728059df3cfc33ef814169d7ca.png"},96506:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/misp_schedule_task_warning-e276c54d41e9c6652f5a093930a0bf9c.png"},28453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>a});var s=t(96540);const i={},o=s.createContext(i);function r(e){const n=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);