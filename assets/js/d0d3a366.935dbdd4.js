"use strict";(self.webpackChunkredback_documentation=self.webpackChunkredback_documentation||[]).push([[3656],{13479:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>h,frontMatter:()=>s,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"project-1/iot/codebase-documentation/drivers/Kickr-climb-&-smart-trainer","title":"Kickr-climb-&-smart-trainer","description":"Last updated by \'25/09/2024\'","source":"@site/docs/project-1/iot/codebase-documentation/drivers/Kickr-climb-&-smart-trainer.md","sourceDirName":"project-1/iot/codebase-documentation/drivers","slug":"/project-1/iot/codebase-documentation/drivers/Kickr-climb-&-smart-trainer","permalink":"/redback-documentation/docs/project-1/iot/codebase-documentation/drivers/Kickr-climb-&-smart-trainer","draft":false,"unlisted":false,"editUrl":"https://github.com/Redback-Operations/redback-documentation/blob/main/docs/project-1/iot/codebase-documentation/drivers/Kickr-climb-&-smart-trainer.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"Button-Control","permalink":"/redback-documentation/docs/project-1/iot/codebase-documentation/drivers/Button-Control"},"next":{"title":"Fan","permalink":"/redback-documentation/docs/project-1/iot/codebase-documentation/drivers/Fan"}}');var r=i(74848),c=i(28453);const s={sidebar_position:2},o="KICKR Climb & Smart Trainer",a={},d=[{value:"Data Reading",id:"data-reading",level:2},{value:"Incline Control",id:"incline-control",level:2},{value:"Resistance Control",id:"resistance-control",level:2},{value:"MQTT Topics",id:"mqtt-topics",level:2},{value:"Data Topics",id:"data-topics",level:3},{value:"Incline Topic",id:"incline-topic",level:3},{value:"Resistance Topic",id:"resistance-topic",level:3},{value:"MQTT Payload",id:"mqtt-payload",level:2},{value:"Driver Location",id:"driver-location",level:2},{value:"An Alternative Driver",id:"an-alternative-driver",level:3}];function l(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,c.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Last updated by:"})," KasparByrne, ",(0,r.jsx)(n.strong,{children:"Last updated on:"})," '25/09/2024'"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Last updated by:"})," KasparByrne, ",(0,r.jsx)(n.strong,{children:"Last updated on:"})," '25/09/2024'"]}),"\n",(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"kickr-climb--smart-trainer",children:"KICKR Climb & Smart Trainer"})}),"\n",(0,r.jsxs)(n.admonition,{title:"Important!",type:"danger",children:[(0,r.jsx)(n.p,{children:"These Bluetooth SIG documents offer greater insight into how this driver works then I can:"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://www.bluetooth.com/specifications/assigned-numbers/",children:"Assigned Numbers"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://www.bluetooth.com/specifications/specs/fitness-machine-service-1-0/",children:"Fitness Machine Service 1.0"})}),"\n"]})]}),"\n",(0,r.jsx)(n.p,{children:"The KICKR's driver has three different functions - compared to the one function all other drivers have:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Read speed, cadence & power data"}),"\n",(0,r.jsx)(n.li,{children:"Control incline"}),"\n",(0,r.jsx)(n.li,{children:"Control resistance"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"data-reading",children:"Data Reading"}),"\n",(0,r.jsxs)(n.p,{children:["Data reading is achieved by enabling notification on the ",(0,r.jsx)(n.code,{children:"indoor_bike_data"})," characteristic with UUID (",(0,r.jsx)(n.a,{href:"https://github.com/Redback-Operations/redback-smartbike-iot/blob/main/Drivers/lib/constants.py#L28",children:"INDOOR_BIKE_DATA_UUID"}),"). Once notification is enabled, when the characteristic updates the ",(0,r.jsx)(n.code,{children:"characteristic_value_updated"})," method is called with the new ",(0,r.jsx)(n.code,{children:"value"})," and the ",(0,r.jsx)(n.code,{children:"process_indoor_bike_data"})," method is called to process the new data."]}),"\n",(0,r.jsx)(n.p,{children:"The data processing is complex and the linked Bluetooth SIG documents should be investigated to understand how it works."}),"\n",(0,r.jsx)(n.h2,{id:"incline-control",children:"Incline Control"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.em,{children:"As a quick note: the incline control does not follow the standards defined by Bluetooth SIG."})}),"\n",(0,r.jsxs)(n.p,{children:["A new incline value can be set by writing to the ",(0,r.jsx)(n.code,{children:"custom_incline_characteristic"})," characteristic - ",(0,r.jsx)(n.a,{href:"https://github.com/Redback-Operations/redback-smartbike-iot/blob/main/Drivers/lib/constants.py#L77",children:"UUID"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["The value must be between -10 and 19, and converted to a byte array using the ",(0,r.jsxs)(n.a,{href:"https://github.com/Redback-Operations/redback-smartbike-iot/blob/main/Drivers/lib/ble_helper.py#L32",children:[(0,r.jsx)(n.code,{children:"convert_incline_to_op_value"})," BLE helper function"]}),". The value must also be paired with the ",(0,r.jsxs)(n.a,{href:"https://github.com/Redback-Operations/redback-smartbike-iot/blob/main/Drivers/lib/constants.py#L81",children:[(0,r.jsx)(n.code,{children:"INCLINE_CONTROL_OP_CODE"})," OP code"]}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"custom_control_point_set_target_inclination"})," method can be passed the integer value to set the new incline."]}),"\n",(0,r.jsx)(n.h2,{id:"resistance-control",children:"Resistance Control"}),"\n",(0,r.jsxs)(n.p,{children:["A new resistance value can be set by writing to the ",(0,r.jsx)(n.code,{children:"ftms_control_point"})," characteristic - ",(0,r.jsx)(n.a,{href:"https://github.com/Redback-Operations/redback-smartbike-iot/blob/main/Drivers/lib/constants.py#L22",children:"UUID"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["The value must be an integer between 0 and 100 - representing a percentage - and converted to a byte array. It must be paired with the ",(0,r.jsxs)(n.a,{href:"https://github.com/Redback-Operations/redback-smartbike-iot/blob/main/Drivers/lib/constants.py#L56",children:[(0,r.jsx)(n.code,{children:"FTMS_SET_TARGET_RESISTANCE_LEVEL"})," OP code"]}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"ftms_set_target_resistance_level"})," method can be passed the integer value to set the new resistance."]}),"\n",(0,r.jsx)(n.h2,{id:"mqtt-topics",children:"MQTT Topics"}),"\n",(0,r.jsxs)(n.p,{children:["Subscribed topics messages are processed by the ",(0,r.jsx)(n.a,{href:"https://github.com/Redback-Operations/redback-smartbike-iot/blob/main/Drivers/kickr_climb_and_smart_trainer/mqtt_custom_client.py",children:"custom MQTT client"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"data-topics",children:"Data Topics"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Topic"}),(0,r.jsx)(n.th,{children:"Data"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"bike/{DEVICE_ID}/speed"})}),(0,r.jsx)(n.td,{children:"Speed data"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"bike/{DEVICE_ID/cadence"})}),(0,r.jsx)(n.td,{children:"Cadence data"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"bike/{DEVICE_ID}/power"})}),(0,r.jsx)(n.td,{children:"Power data"})]})]})]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsxs)(n.em,{children:["This should be changed to conform to the ",(0,r.jsx)(n.a,{href:"/redback-documentation/docs/project-1/iot/codebase-documentation/MQTT-Topics",children:"MQTT Topics"})," documents convention:"]})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"bike/{DEVICE_ID}/speed/report"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"bike/{DEVICE_ID/cadence/report"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"bike/{DEVICE_ID}/power/report"})}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"incline-topic",children:"Incline Topic"}),"\n",(0,r.jsx)(n.p,{children:"The incline is controlled using the topic:"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"bike/{DEVICE_ID}/incline"})}),"\n",(0,r.jsx)(n.p,{children:"With the package expected to be only an integer."}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsxs)(n.em,{children:["This should be changed to conform to the ",(0,r.jsx)(n.a,{href:"/redback-documentation/docs/project-1/iot/codebase-documentation/MQTT-Topics",children:"MQTT Topics"})," documents convention:"]})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"bike/{DEVICE_ID}/incline/control"})}),"\n",(0,r.jsx)(n.h3,{id:"resistance-topic",children:"Resistance Topic"}),"\n",(0,r.jsx)(n.p,{children:"The resistance is controlled using the topic:"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"bike/{DEVICE_ID}/resistance"})}),"\n",(0,r.jsx)(n.p,{children:"With the package expected to be only an integer."}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsxs)(n.em,{children:["This should be changed to conform to the ",(0,r.jsx)(n.a,{href:"/redback-documentation/docs/project-1/iot/codebase-documentation/MQTT-Topics",children:"MQTT Topics"})," documents convention:"]})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"bike/{DEVICE_ID}/resistance/control"})}),"\n",(0,r.jsx)(n.h2,{id:"mqtt-payload",children:"MQTT Payload"}),"\n",(0,r.jsx)(n.p,{children:"The data (speed, cadence, power) payload follows a JSON structure:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"{\r\n    'value' : [cadence | speed | power]\r\n    'unitName' : [a unit metric relevent to the data type]\r\n    'timestamp' : [the time at publish]\r\n    'metadata' : {\r\n        'deviceName' : [some identifier of the publishing device]\r\n    }\r\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"driver-location",children:"Driver Location"}),"\n",(0,r.jsx)(n.p,{children:"This driver has two parts:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Core driver code - ",(0,r.jsx)(n.a,{href:"https://github.com/Redback-Operations/redback-smartbike-iot/blob/main/Drivers/kickr_climb_and_smart_trainer/wahoo_device.py",children:"Drivers/kickr_climb_and_smart_trainer/wahoo_device.py"})]}),"\n",(0,r.jsxs)(n.li,{children:["Driver starter - ",(0,r.jsx)(n.a,{href:"https://github.com/Redback-Operations/redback-smartbike-iot/blob/main/Drivers/kickr_climb_and_smart_trainer/incline_and_resistance_control.py",children:"Drivers/kickr_climb_and_smart_trainer/incline_and_resistance_control.py"})]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"an-alternative-driver",children:"An Alternative Driver"}),"\n",(0,r.jsxs)(n.p,{children:["Two alternative driver ",(0,r.jsx)(n.code,{children:"wahoo_controller.py"})," and ",(0,r.jsx)(n.code,{children:"smartbike.py"})," were developed to implement many of the above requirements. ",(0,r.jsx)(n.code,{children:"wahoo_controller.py"})," works and has a starter ",(0,r.jsx)(n.code,{children:"wahoo_controller_starter.py"}),". ",(0,r.jsx)(n.code,{children:"smartbike.py"})," is an extension of ",(0,r.jsx)(n.code,{children:"wahoo_controller.py"})," to cover all drivers but was developed late and is not functional (I would not recommand using it)."]}),"\n",(0,r.jsx)(n.admonition,{title:"Important!",type:"danger",children:(0,r.jsxs)(n.p,{children:["The VR game's incline control was developed to use the improved incline control payload used by the ",(0,r.jsx)(n.code,{children:"wahoo_controller.py"})," driver. You should use the ",(0,r.jsx)(n.code,{children:"wahoo_controller.py"})," driver over the ",(0,r.jsx)(n.code,{children:"kickr_climb_and_smart_trainer"})," driver."]})}),"\n",(0,r.jsxs)(n.p,{children:["Location - ",(0,r.jsx)(n.a,{href:"https://github.com/Redback-Operations/redback-smartbike-iot/tree/main/Drivers/smartbike",children:"Drivers/smartbike_driver/smartbike/"})]})]})}function h(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>s,x:()=>o});var t=i(96540);const r={},c=t.createContext(r);function s(e){const n=t.useContext(c);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),t.createElement(c.Provider,{value:n},e.children)}}}]);