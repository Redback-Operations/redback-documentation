"use strict";(self.webpackChunkredback_documentation=self.webpackChunkredback_documentation||[]).push([[2192],{59358:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>c,default:()=>h,frontMatter:()=>d,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"project-1/iot/codebase-documentation/drivers/Fan","title":"Fan","description":"Last updated by \'25/09/2024\'","source":"@site/docs/project-1/iot/codebase-documentation/drivers/Fan.md","sourceDirName":"project-1/iot/codebase-documentation/drivers","slug":"/project-1/iot/codebase-documentation/drivers/Fan","permalink":"/redback-documentation/docs/project-1/iot/codebase-documentation/drivers/Fan","draft":false,"unlisted":false,"editUrl":"https://github.com/Redback-Operations/redback-documentation/blob/main/docs/project-1/iot/codebase-documentation/drivers/Fan.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"tutorialSidebar","previous":{"title":"Kickr-climb-&-smart-trainer","permalink":"/redback-documentation/docs/project-1/iot/codebase-documentation/drivers/Kickr-climb-&-smart-trainer"},"next":{"title":"Heart-rate-sensor","permalink":"/redback-documentation/docs/project-1/iot/codebase-documentation/drivers/Heart-rate-sensor"}}');var r=t(74848),s=t(28453);const d={sidebar_position:3},c="Fan Driver",o={},a=[{value:"GATT Device",id:"gatt-device",level:2},{value:"MQTT Topics",id:"mqtt-topics",level:2},{value:"Speed Value Binning",id:"speed-value-binning",level:2},{value:"Driver Location",id:"driver-location",level:2}];function l(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Last updated by:"})," KasparByrne, ",(0,r.jsx)(n.strong,{children:"Last updated on:"})," '25/09/2024'"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Last updated by:"})," KasparByrne, ",(0,r.jsx)(n.strong,{children:"Last updated on:"})," '25/09/2024'"]}),"\n",(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"fan-driver",children:"Fan Driver"})}),"\n",(0,r.jsx)(n.admonition,{title:"Important!",type:"danger",children:(0,r.jsxs)(n.p,{children:["The fan driver code is quiet rough and requires a major rewrite. Relevant characteristics & services were not documented and it is unclear what characteristics do what. The flow control is basically ",(0,r.jsx)(n.em,{children:"try again and hope"}),"."]})}),"\n",(0,r.jsx)(n.p,{children:"The fan driver code drives the Wahoo Headwind Fan, controlling its blowing force."}),"\n",(0,r.jsx)(n.h2,{id:"gatt-device",children:"GATT Device"}),"\n",(0,r.jsxs)(n.p,{children:["The driver is primarily driven by a ",(0,r.jsx)(n.code,{children:"gatt.Device"})," object which connects to the Fan and then writes to the relevant characteristics."]}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Service/Characteristic"}),(0,r.jsx)(n.th,{children:"UUID"}),(0,r.jsx)(n.th,{children:"Purpose"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"enable_service"})}),(0,r.jsxs)(n.td,{children:["ending-",(0,r.jsx)(n.code,{children:"ee01"})]}),(0,r.jsxs)(n.td,{children:["Holds the ",(0,r.jsx)(n.code,{children:"enable_characteristic"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"enable_characteristic"})}),(0,r.jsxs)(n.td,{children:["ending-",(0,r.jsx)(n.code,{children:"e002"})]}),(0,r.jsx)(n.td,{children:"Likely the FTMS control point of the Headwind Fan - an array of bytes is written to it with a comment indicating that it is to request writing permissions"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"fan_service"})}),(0,r.jsxs)(n.td,{children:["ending-",(0,r.jsx)(n.code,{children:"ee0c"})]}),(0,r.jsxs)(n.td,{children:["Holds the ",(0,r.jsx)(n.code,{children:"fan_characteristic"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"fan_characteristic"})}),(0,r.jsxs)(n.td,{children:["ending-",(0,r.jsx)(n.code,{children:"e038"})]}),(0,r.jsx)(n.td,{children:"Likely the custom fan control point - two arrays of bytes are written to it with comments indicating that they are to turn the fan on and to write a new blowing force"})]})]})]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.em,{children:"UUIDs can be matched to their characteristic/service using the following two Bluetooth SIG documents:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.em,{children:(0,r.jsx)(n.a,{href:"https://www.bluetooth.com/specifications/assigned-numbers/",children:"Assigned Numbers"})})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.em,{children:(0,r.jsx)(n.a,{href:"https://www.bluetooth.com/specifications/specs/fitness-machine-service-1-0/",children:"Fitness Machine Service 1.0"})})}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.em,{children:"No proper flow control is implemented instead values are rewritten multiple times with the hope that they will be successfully written."})}),"\n",(0,r.jsx)(n.h2,{id:"mqtt-topics",children:"MQTT Topics"}),"\n",(0,r.jsx)(n.p,{children:"The implemented MQTT topic is the KICKR smart trainer's speed publishing topic:"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"bike/{DEVICE_ID}/speed"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsxs)(n.em,{children:["This should be changed to conform to the ",(0,r.jsx)(n.a,{href:"/redback-documentation/docs/project-1/iot/codebase-documentation/MQTT-Topics",children:"MQTT Topics"})," documents convention:"]})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"bike/{DEVICE_ID}/fan/control"})}),"\n",(0,r.jsx)(n.h2,{id:"speed-value-binning",children:"Speed Value Binning"}),"\n",(0,r.jsx)(n.p,{children:"The blow force of the Headwind Fan is a percentage between 0 and 100."}),"\n",(0,r.jsx)(n.p,{children:"The current fan driver implementation bins speed values into 6 bins."}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Bin Range"}),(0,r.jsx)(n.th,{children:"Blow Force"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"0"}),(0,r.jsx)(n.td,{children:"0%"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"0 - 4"}),(0,r.jsx)(n.td,{children:"20%"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"4 - 8"}),(0,r.jsx)(n.td,{children:"40%"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"8 - 12"}),(0,r.jsx)(n.td,{children:"60%"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"12 - 16"}),(0,r.jsx)(n.td,{children:"80%"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:">16"}),(0,r.jsx)(n.td,{children:"100%"})]})]})]}),"\n",(0,r.jsx)(n.admonition,{title:"Important!",type:"danger",children:(0,r.jsx)(n.p,{children:"It is better to let application developers decide how they want the fan's power to be controlled. Forcing a relationship between speed and fan force, in addition to forcing a set number of steps in blow force, is bad."})}),"\n",(0,r.jsx)(n.h2,{id:"driver-location",children:"Driver Location"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"https://github.com/Redback-Operations/redback-smartbike-iot/blob/main/Drivers/fan/fan.py",children:"Drivers/fan/fan.py"})})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>d,x:()=>c});var i=t(96540);const r={},s=i.createContext(r);function d(e){const n=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:d(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);