"use strict";(self.webpackChunkredback_documentation=self.webpackChunkredback_documentation||[]).push([[2469],{84709:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>i,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"cybersecurity/Blue Team/Graylog Setup/Graylog setup with TLS","title":"Graylog setup with TLS","description":"Last updated by \'09/05/2025\'","source":"@site/docs/cybersecurity/Blue Team/Graylog Setup/Graylog setup with TLS.md","sourceDirName":"cybersecurity/Blue Team/Graylog Setup","slug":"/cybersecurity/Blue Team/Graylog Setup/Graylog setup with TLS","permalink":"/redback-documentation/docs/cybersecurity/Blue Team/Graylog Setup/Graylog setup with TLS","draft":false,"unlisted":false,"editUrl":"https://github.com/Redback-Operations/redback-documentation/blob/main/docs/cybersecurity/Blue Team/Graylog Setup/Graylog setup with TLS.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"Graylog - Wazuh Integration","permalink":"/redback-documentation/docs/category/graylog---wazuh-integration"},"next":{"title":"Graylog and Logstash Comparative Analysis","permalink":"/redback-documentation/docs/cybersecurity/Blue Team/Graylog Setup/Graylog and Logstash Comparative Analysis"}}');var t=r(74848),a=r(28453);const i={sidebar_position:1},o="Graylog Setup and TLS Integration Report",l={},c=[{value:"Background",id:"background",level:2},{value:"Purpose of This Report",id:"purpose-of-this-report",level:3},{value:"1. Graylog Installation Summary",id:"1-graylog-installation-summary",level:3},{value:"1.1 OS and Dependencies",id:"11-os-and-dependencies",level:3},{value:"1.2 MongoDB Setup",id:"12-mongodb-setup",level:3},{value:"1.3 Graylog Server Installation",id:"13-graylog-server-installation",level:3},{value:"1.4 Graylog Web Interface Setup",id:"14-graylog-web-interface-setup",level:3},{value:"2. TLS Truststore Integration (Graylog \u2194 Wazuh Indexer)",id:"2-tls-truststore-integration-graylog--wazuh-indexer",level:3},{value:"2.1 Problem Statement",id:"21-problem-statement",level:3},{value:"2.2 Solution Overview",id:"22-solution-overview",level:3},{value:"2.3 Certificate Preparation",id:"23-certificate-preparation",level:3},{value:"2.4 Truststore Import",id:"24-truststore-import",level:3},{value:"2.5 Graylog Configuration/JVM Truststore Activation",id:"25-graylog-configurationjvm-truststore-activation",level:3},{value:"2.6 Trust Validation",id:"26-trust-validation",level:3},{value:"3.0 Graylog Configuration Review",id:"30-graylog-configuration-review",level:3},{value:"3.1 Secure Alternative Format",id:"31-secure-alternative-format",level:3},{value:"4. Final Verification",id:"4-final-verification",level:3},{value:"Appendix",id:"appendix",level:4},{value:"Video Tutorial",id:"video-tutorial",level:2}];function d(e){const n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Last updated by:"})," Elvis Ifeanyi Nwosu, ",(0,t.jsx)(n.strong,{children:"Last updated on:"})," '09/05/2025'"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Last updated by:"})," Elvis Ifeanyi Nwosu, ",(0,t.jsx)(n.strong,{children:"Last updated on:"})," '09/05/2025'"]}),"\n",(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"graylog-setup-and-tls-integration-report",children:"Graylog Setup and TLS Integration Report"})}),"\n",(0,t.jsxs)(n.admonition,{type:"info",children:[(0,t.jsx)(n.p,{children:"Document Creation: 2025-04-9. Last Edited: 2025-05-08. Authors: Elvis Nwosu"}),(0,t.jsx)(n.p,{children:"Document Code: Graylog_Setup_V1. Effective Date: 2025-05-08. Expiry Date: 2026-05-08"})]}),"\n",(0,t.jsx)(n.h2,{id:"background",children:"Background"}),"\n",(0,t.jsx)(n.p,{children:"Graylog is a centralized log management and analysis platform designed to help IT and security teams collect, normalize, and analyze large volumes of log data from distributed systems. With the increasing complexity of IT infrastructures and growing cybersecurity threats, centralized logging is essential for detecting anomalies, auditing system activity, and investigating security incidents in real-time."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Graylog integration diagram",src:r(59352).A+"",width:"1536",height:"1024"})}),"\n",(0,t.jsx)(n.p,{children:"As part of our security operations, implementing Graylog complements the Wazuh SIEM platform. While Wazuh provides endpoint monitoring and alerting, Graylog enhances visibility through intuitive dashboards, advanced search capabilities, and structured log correlation. This integration also provides a foundation for correlating log activity with threat intelligence from MISP (Malware Information Sharing Platform)."}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h3,{id:"purpose-of-this-report",children:"Purpose of This Report"}),"\n",(0,t.jsx)(n.p,{children:"This report provides a comprehensive walkthrough of the setup and TLS configuration process for Graylog. It focuses on establishing secure communications between Graylog and the Wazuh Indexer using trusted certificates. The goal is to ensure encrypted data exchange and validate that Graylog can securely ingest and query data from OpenSearch (used by Wazuh)."}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h3,{id:"1-graylog-installation-summary",children:"1. Graylog Installation Summary"}),"\n",(0,t.jsx)(n.h3,{id:"11-os-and-dependencies",children:"1.1 OS and Dependencies"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Operating System:"})," Ubuntu Server 22.04"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Java Runtime:"})," OpenJDK 17 is required for Graylog's backend engine."]}),"\n",(0,t.jsx)(n.li,{children:"Node name: capstone.node-1"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"sudo apt install openjdk-17-jre-headless\n"})}),"\n",(0,t.jsx)(n.h3,{id:"12-mongodb-setup",children:"1.2 MongoDB Setup"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Purpose:"})," Stores Graylog metadata such as users, roles, and configuration settings."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Version Installed:"})," MongoDB 6.0"]}),"\n",(0,t.jsx)(n.li,{children:"After resolving held packages and source priority issues, MongoDB was successfully installed and confirmed to be running."}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Screenshot showing mongoDB active and running"}),"\r\n",(0,t.jsx)(n.img,{alt:"MongoDB Status",src:r(60021).A+"",width:"1844",height:"239"})]}),"\n",(0,t.jsx)(n.h3,{id:"13-graylog-server-installation",children:"1.3 Graylog Server Installation"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Added the Graylog 5.1 repository and installed the package:"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"wget https://packages.graylog2.org/repo/packages/graylog-5.1-repository_latest.deb\r\nsudo dpkg -i graylog-5.1-repository_latest.deb\r\nsudo apt update && sudo apt install graylog-server\r\nsudo systemctl start mongod\n"})}),"\n",(0,t.jsx)(n.h3,{id:"14-graylog-web-interface-setup",children:"1.4 Graylog Web Interface Setup"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Default web interface available at ",(0,t.jsx)(n.code,{children:"http://<server-ip>:9000"})]}),"\n",(0,t.jsx)(n.li,{children:"Configured initial admin user and accessed the dashboard for operational verification."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Graylog dashboard login",src:r(79658).A+"",width:"1125",height:"784"})}),"\n",(0,t.jsx)(n.h3,{id:"2-tls-truststore-integration-graylog--wazuh-indexer",children:"2. TLS Truststore Integration (Graylog \u2194 Wazuh Indexer)"}),"\n",(0,t.jsx)(n.h3,{id:"21-problem-statement",children:"2.1 Problem Statement"}),"\n",(0,t.jsx)(n.p,{children:"When attempting to connect Graylog with Wazuh\u2019s OpenSearch-based indexer using HTTPS, the following error was encountered:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-text",children:"PKIX path validation failed: Path does not chain with any of the trust anchors.\n"})}),"\n",(0,t.jsx)(n.p,{children:"This indicated that Graylog\u2019s JVM did not trust the certificate served by the Wazuh Indexer."}),"\n",(0,t.jsx)(n.h3,{id:"22-solution-overview",children:"2.2 Solution Overview"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Created a custom truststore specifically for Graylog."}),"\n",(0,t.jsxs)(n.li,{children:["Imported Wazuh's internal root CA into the truststore using ",(0,t.jsx)(n.code,{children:"keytool"}),"."]}),"\n",(0,t.jsx)(n.li,{children:"Updated Graylog\u2019s JVM options to reference the custom truststore."}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"23-certificate-preparation",children:"2.3 Certificate Preparation"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Files used:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"/etc/wazuh-indexer/certs/indexer.pem\r\n/etc/wazuh-indexer/certs/root-ca.pem\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Command to generate full certificate chain:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"cat indexer.pem root-ca.pem > fullchain.pem\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Screenshot of certificate chain validation using OpenSSL"}),"\r\n",(0,t.jsx)(n.img,{alt:"Certificate Chain Validation using OpenSSL",src:r(19464).A+"",width:"1093",height:"435"})]}),"\n",(0,t.jsx)(n.p,{children:"To validate the certificate chain using OpenSSL, the following command was used:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"openssl s_client -connect capstone.node-1:9200 -CAfile /etc/wazuh-indexer/certs/root-ca.pem\n"})}),"\n",(0,t.jsx)(n.h3,{id:"24-truststore-import",children:"2.4 Truststore Import"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"cp -a /usr/lib/jvm/java-17-openjdk-amd64/lib/security/cacerts /etc/graylog/server/certs/cacerts\r\nkeytool -importcert -keystore /etc/graylog/server/certs/cacerts   -storepass <password> -alias root_ca   -file /etc/wazuh-indexer/certs/root-ca.pem\n"})}),"\n",(0,t.jsx)(n.h3,{id:"25-graylog-configurationjvm-truststore-activation",children:"2.5 Graylog Configuration/JVM Truststore Activation"}),"\n",(0,t.jsx)(n.p,{children:"Edited the configuration file located at /etc/graylog/server/server.conf by generating and adding the password secret and root password using the following commands:"}),"\n",(0,t.jsx)(n.p,{children:"Password secret generation:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"pwgen -N 1 -s 96\n"})}),"\n",(0,t.jsx)(n.p,{children:"Root password generation:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'echo -n "Enter Password: " && head -1 </dev/stdin | tr -d \'\\n\' | sha256sum | cut -d" " -f1\n'})}),"\n",(0,t.jsx)(n.p,{children:"Created the internal User on Wazuh, assigning it a chosen backend role using the following command:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'curl -k -u \'<username:<password>\' \\\r\n  -XPUT "https://192.168.56.109:9200/_plugins/_security/api/internalusers/$GRAYLOG_USER" \\\r\n  -H "Content-Type: application/json" \\\r\n  -d \'{\r\n    "password": "<password>",\r\n    "backend_roles": ["admin"],\r\n    "attributes": {}\r\n  }\'\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Added the following options in ",(0,t.jsx)(n.code,{children:"/etc/default/graylog-server"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"-Djavax.net.ssl.trustStore=/etc/graylog/server/certs/cacerts\r\n-Djavax.net.ssl.trustStorePassword=<password>\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Screenshot of JVM Truststore Import Success"}),"\r\n",(0,t.jsx)(n.img,{alt:"JVM Truststore Import Success",src:r(97795).A+"",width:"1607",height:"632"})]}),"\n",(0,t.jsx)(n.h3,{id:"26-trust-validation",children:"2.6 Trust Validation"}),"\n",(0,t.jsxs)(n.p,{children:["Used ",(0,t.jsx)(n.code,{children:"curl"})," to validate the chain and confirm a successful TLS handshake:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"curl -vk https://capstone.node-1:9200\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Output:"})," The verify return code was ",(0,t.jsx)(n.code,{children:"0 (ok)"}),"."]}),"\n",(0,t.jsx)(n.h3,{id:"30-graylog-configuration-review",children:"3.0 Graylog Configuration Review"}),"\n",(0,t.jsxs)(n.p,{children:["Updated ",(0,t.jsx)(n.code,{children:"/etc/graylog/server/server.conf"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ini",children:"elasticsearch_hosts = https://<userame>:<password>@capstone.node-1:9200\r\nelasticsearch_tls_verify = true\r\ntransport_tls_trust_store_path = /etc/graylog/server/certs/cacerts\r\ntransport_tls_trust_store_password = <password>\n"})}),"\n",(0,t.jsx)(n.h3,{id:"31-secure-alternative-format",children:"3.1 Secure Alternative Format"}),"\n",(0,t.jsx)(n.p,{children:"Instead of embedding credentials in the URL, use the secure format:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ini",children:"elasticsearch_hosts = https://capstone.node-1:9200\r\nelasticsearch_username = <username>\r\nelasticsearch_password = <password>\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h3,{id:"4-final-verification",children:"4. Final Verification"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Graylog successfully connected to Wazuh Indexer over HTTPS."}),"\n",(0,t.jsx)(n.li,{children:"TLS certificate chain was validated."}),"\n",(0,t.jsx)(n.li,{children:"Logs showed successful authentication and data ingestion."}),"\n",(0,t.jsxs)(n.li,{children:["No further errors were present in ",(0,t.jsx)(n.code,{children:"/var/log/graylog-server/server.log"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Screenshot of Graylog Indexer Connection Success"}),"\r\n",(0,t.jsx)(n.img,{alt:"Graylog Indexer Connection Success",src:r(91610).A+"",width:"1104",height:"228"})]}),"\n",(0,t.jsx)(n.h4,{id:"appendix",children:"Appendix"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Tools Used:"})," OpenSSL, keytool, curl, systemctl"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Log and Config Files Modified:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"/etc/graylog/server/server.conf"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"/etc/default/graylog-server"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"/etc/graylog/server/certs/cacerts"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"video-tutorial",children:"Video Tutorial"}),"\n",(0,t.jsx)("iframe",{width:"560",height:"315",src:"https://www.youtube.com/embed/NfL24OvJXdg",title:"YouTube video player",frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",allowfullscreen:!0})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},59352:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/Img-graylog-wazuh-12c1315d5bf7a40a91b937627aa1cf1d.png"},19464:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/image-1-785ce044eda21a928e692e46fa363bfa.png"},97795:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/image-2-256bab415a3a39db9f8557d2a990969a.png"},91610:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/image-3-92595eb0984f1910d1a7580c78cdcb66.png"},60021:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/image-4-73aac2f5e8eb2d0d6706f29e19c2722c.png"},79658:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/image-374d59ec780fb2c6f9e2bb2c5d3bde6f.png"},28453:(e,n,r)=>{r.d(n,{R:()=>i,x:()=>o});var s=r(96540);const t={},a=s.createContext(t);function i(e){const n=s.useContext(a);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),s.createElement(a.Provider,{value:n},e.children)}}}]);