"use strict";(self.webpackChunkredback_documentation=self.webpackChunkredback_documentation||[]).push([[2005],{55132:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>c,contentTitle:()=>d,default:()=>l,frontMatter:()=>a,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"project-1/iot/codebase-documentation/drivers/Heart-rate-sensor","title":"Heart-rate-sensor","description":"Last updated by \'25/09/2024\'","source":"@site/docs/project-1/iot/codebase-documentation/drivers/Heart-rate-sensor.md","sourceDirName":"project-1/iot/codebase-documentation/drivers","slug":"/project-1/iot/codebase-documentation/drivers/Heart-rate-sensor","permalink":"/redback-documentation/docs/project-1/iot/codebase-documentation/drivers/Heart-rate-sensor","draft":false,"unlisted":false,"editUrl":"https://github.com/Redback-Operations/redback-documentation/blob/main/docs/project-1/iot/codebase-documentation/drivers/Heart-rate-sensor.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4},"sidebar":"tutorialSidebar","previous":{"title":"Fan","permalink":"/redback-documentation/docs/project-1/iot/codebase-documentation/drivers/Fan"},"next":{"title":"Cadence-sensor","permalink":"/redback-documentation/docs/project-1/iot/codebase-documentation/drivers/Cadence-sensor"}}');var i=r(74848),n=r(28453);const a={sidebar_position:4},d="Heart Rate Sensor",c={},o=[{value:"GATT Device",id:"gatt-device",level:2},{value:"Extracting Heart Rate Data",id:"extracting-heart-rate-data",level:2},{value:"MQTT Topics",id:"mqtt-topics",level:2},{value:"Driver Location",id:"driver-location",level:2}];function h(e){const t={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,n.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:"Last updated by:"})," KasparByrne, ",(0,i.jsx)(t.strong,{children:"Last updated on:"})," '25/09/2024'"]}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:"Last updated by:"})," KasparByrne, ",(0,i.jsx)(t.strong,{children:"Last updated on:"})," '25/09/2024'"]}),"\n",(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"heart-rate-sensor",children:"Heart Rate Sensor"})}),"\n",(0,i.jsx)(t.p,{children:"The heart_rate_sensor driver drives the TICKR heart rate monitor, pulling heart rate data from the TICKR."}),"\n",(0,i.jsx)(t.h2,{id:"gatt-device",children:"GATT Device"}),"\n",(0,i.jsxs)(t.p,{children:["The driver is primarily driven by a ",(0,i.jsx)(t.code,{children:"gatt.Device"})," object which connects and reads data from the TICKR heart rate monitor through its characteristics."]}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"Service/Characteristic"}),(0,i.jsx)(t.th,{children:"UUID"}),(0,i.jsx)(t.th,{children:"Purpose"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"heart_rate_service"})}),(0,i.jsxs)(t.td,{children:["ending-",(0,i.jsx)(t.code,{children:"180d"})]}),(0,i.jsxs)(t.td,{children:["Holds the ",(0,i.jsx)(t.code,{children:"heart_rate_measurement_characteristic"})," characteristic"]})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"heart_rate_measurement_characteristic"})}),(0,i.jsxs)(t.td,{children:["ending-",(0,i.jsx)(t.code,{children:"2a37"})]}),(0,i.jsx)(t.td,{children:"Readable characteristic which holds the measured heart rate data"})]})]})]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.em,{children:"UUIDs can be matched to their characteristic/service using the following two Bluetooth SIG documents:"})}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.em,{children:(0,i.jsx)(t.a,{href:"https://www.bluetooth.com/specifications/assigned-numbers/",children:"Assigned Numbers"})})}),"\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.em,{children:(0,i.jsx)(t.a,{href:"https://www.bluetooth.com/specifications/specs/fitness-machine-service-1-0/",children:"Fitness Machine Service 1.0"})})}),"\n"]}),"\n",(0,i.jsx)(t.h2,{id:"extracting-heart-rate-data",children:"Extracting Heart Rate Data"}),"\n",(0,i.jsxs)(t.p,{children:["Notification is enabled for the ",(0,i.jsx)(t.code,{children:"heart_rate_measurement_characteristic"})," characteristic and so when it updates the ",(0,i.jsx)(t.code,{children:"characteristic_value_updated"})," method is called with the new heart rate data."]}),"\n",(0,i.jsx)(t.p,{children:"The heart rate data is stored in a series of bytes with a preceding flag byte to indicate the format of the data and what data is present."}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.strong,{children:"Flags"})}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"Bit Position"}),(0,i.jsx)(t.th,{children:"Meaning"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"0"}),(0,i.jsx)(t.td,{children:"set if the heart rate is 16 bit (otherwise 8 bit)"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"1"}),(0,i.jsx)(t.td,{children:"set if contact is detected (only valid if bit 2 is also set)"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"2"}),(0,i.jsx)(t.td,{children:"set if contact status is reported"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"3"}),(0,i.jsx)(t.td,{children:"set if energy expenditure is reported"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"4"}),(0,i.jsx)(t.td,{children:"set if rr interval is reported"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"5-7"}),(0,i.jsx)(t.td,{children:"reserved for future use (ignored)"})]})]})]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.strong,{children:"Measurements"})}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"Heart rate (beats per minute) [uint8, or uint16 if flags Bit 0 is set]"}),"\n",(0,i.jsx)(t.li,{children:"Energy (kJ) [uint16, only present if flags Bit 3 is set]"}),"\n",(0,i.jsx)(t.li,{children:"RR Interval (1/1024 seconds) [Remaining bytes until end of packet, only present if flags bit 4 is set]"}),"\n"]}),"\n",(0,i.jsx)(t.h2,{id:"mqtt-topics",children:"MQTT Topics"}),"\n",(0,i.jsx)(t.p,{children:"Heart rate data is published to the following topic:"}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.code,{children:"bike/{DEVICE_ID}/heartrate"})}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsxs)(t.em,{children:["This should be changed to conform to the ",(0,i.jsx)(t.a,{href:"/redback-documentation/docs/project-1/iot/codebase-documentation/MQTT-Topics",children:"MQTT Topics"})," documents convention:"]})}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.code,{children:"bike/{DEVICE_ID}/heartrate/report"})}),"\n",(0,i.jsx)(t.h2,{id:"driver-location",children:"Driver Location"}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.a,{href:"https://github.com/Redback-Operations/redback-smartbike-iot/blob/main/Drivers/heart_rate_sensor/heartrate.py",children:"Drivers/heart_rate_sensor/heartrate.py"})})]})}function l(e={}){const{wrapper:t}={...(0,n.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},28453:(e,t,r)=>{r.d(t,{R:()=>a,x:()=>d});var s=r(96540);const i={},n=s.createContext(i);function a(e){const t=s.useContext(n);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function d(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),s.createElement(n.Provider,{value:t},e.children)}}}]);