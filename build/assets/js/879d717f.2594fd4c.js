"use strict";(self.webpackChunkredback_documentation=self.webpackChunkredback_documentation||[]).push([[7720],{55662:(e,s,i)=>{i.r(s),i.d(s,{assets:()=>d,contentTitle:()=>l,default:()=>h,frontMatter:()=>a,metadata:()=>n,toc:()=>c});const n=JSON.parse('{"id":"cybersecurity/Blue Team/email-infra-security/phase5","title":"phase5","description":"Last updated by \'19/05/2025\'","source":"@site/docs/cybersecurity/Blue Team/email-infra-security/phase5.md","sourceDirName":"cybersecurity/Blue Team/email-infra-security","slug":"/cybersecurity/Blue Team/email-infra-security/phase5","permalink":"/redback-documentation/docs/cybersecurity/Blue Team/email-infra-security/phase5","draft":false,"unlisted":false,"editUrl":"https://github.com/Redback-Operations/redback-documentation/blob/main/docs/cybersecurity/Blue Team/email-infra-security/phase5.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5},"sidebar":"tutorialSidebar","previous":{"title":"phase4","permalink":"/redback-documentation/docs/cybersecurity/Blue Team/email-infra-security/phase4"},"next":{"title":"MISP","permalink":"/redback-documentation/docs/category/misp"}}');var t=i(74848),r=i(28453);const a={sidebar_position:5},l="Phase 5 \u2013 Additional Security Controls",d={},c=[{value:"Objective",id:"objective",level:2},{value:"Deliverables",id:"deliverables",level:2},{value:"Important Notes",id:"important-notes",level:2},{value:"12. Block Emails from Malicious Senders and Sender Domains (via Mail Flow Rule)",id:"12-block-emails-from-malicious-senders-and-sender-domains-via-mail-flow-rule",level:2},{value:"12.1. IMPLEMENT",id:"121-implement",level:3},{value:"12.2. VALIDATE",id:"122-validate",level:3},{value:"13. Block Emails from Malicious IP Addresses (via Connection Filtering Policy)",id:"13-block-emails-from-malicious-ip-addresses-via-connection-filtering-policy",level:2},{value:"13.1. IMPLEMENT",id:"131-implement",level:3},{value:"13.2. VALIDATE",id:"132-validate",level:3},{value:"14. Enable Email Activity Logging and Auditing for all Mailboxes",id:"14-enable-email-activity-logging-and-auditing-for-all-mailboxes",level:2},{value:"14.1. IMPLEMENT",id:"141-implement",level:3},{value:"14.2. VALIDATE",id:"142-validate",level:3},{value:"15. Enforce Multi-Factor Authentication (MFA)",id:"15-enforce-multi-factor-authentication-mfa",level:2},{value:"15.1. IMPLEMENT",id:"151-implement",level:3},{value:"15.2. VALIDATE",id:"152-validate",level:3},{value:"16. Enforce Strict TLS Encryption via MTA-STS",id:"16-enforce-strict-tls-encryption-via-mta-sts",level:2},{value:"16.1. IMPLEMENT",id:"161-implement",level:3},{value:"16.1.1. Host MTA-STS Policy via GitHub Pages",id:"1611-host-mta-sts-policy-via-github-pages",level:4},{value:"16.1.2. Add DNS Records",id:"1612-add-dns-records",level:4},{value:"16.2. VALIDATE",id:"162-validate",level:3},{value:"16.2.1. Using Command Line Tools (e.g., nslookup)",id:"1621-using-command-line-tools-eg-nslookup",level:4},{value:"16.2.2. Using Online Tools (MXToolbox, Hardenize)",id:"1622-using-online-tools-mxtoolbox-hardenize",level:4},{value:"16.2.3. Test Email Delivery",id:"1623-test-email-delivery",level:4},{value:"16.2.3.3. RESULT \u2013 Evidence of MTA-STS Enforcement",id:"16233-result--evidence-of-mta-sts-enforcement",level:4},{value:"References",id:"references",level:2}];function o(e){const s={a:"a",admonition:"admonition",blockquote:"blockquote",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Last updated by:"})," bg-11, ",(0,t.jsx)(s.strong,{children:"Last updated on:"})," '19/05/2025'"]}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Last updated by:"})," bg-11, ",(0,t.jsx)(s.strong,{children:"Last updated on:"})," '19/05/2025'"]}),"\n",(0,t.jsx)(s.header,{children:(0,t.jsx)(s.h1,{id:"phase-5--additional-security-controls",children:"Phase 5 \u2013 Additional Security Controls"})}),"\n",(0,t.jsx)(s.admonition,{type:"info",children:(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Document Creation:"})," 16 May, 2025. ",(0,t.jsx)(s.strong,{children:"Last Edited:"})," 16 May, 2025. ",(0,t.jsx)(s.strong,{children:"Authors:"})," Bikendra Gurung.\r\n",(0,t.jsx)("br",{}),(0,t.jsx)(s.strong,{children:"Effective Date:"})," 16 May, 2025. ",(0,t.jsx)(s.strong,{children:"Expiry Date:"})," 16 May, 2026."]})}),"\n",(0,t.jsx)(s.h2,{id:"objective",children:"Objective"}),"\n",(0,t.jsx)(s.p,{children:"The objective of this phase is to further implement advanced email, identity and communication security controls to safeguard Redback Operations\u2019 email and identity infrastructure against phishing, credential abuse, and unauthorised access."}),"\n",(0,t.jsx)(s.p,{children:"This phase focuses on enforcing sender filtering, identity protection, auditing and logging, and encrypted email transmission as per industry best practices."}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h2,{id:"deliverables",children:"Deliverables"}),"\n",(0,t.jsx)(s.p,{children:"Outlined below are the security controls that have been implemented and validated in this phase."}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["Controls 12, 13, 14 and 15 were implemented and validated using PowerShell, which can be found in the \u2018redback-cyber\u2019 GitHub repository (link below):","\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["Control 12\u201314: ",(0,t.jsx)(s.a,{href:"https://github.com/Redback-Operations/redback-cyber/blob/main/T1_2025/Email%20Infrastructure%20%26%20Security/Set-MailflowSecurity-AuditControls-Phase5.ps1",children:"Set-MailflowSecurity-AuditControls-Phase5.ps1"})]}),"\n",(0,t.jsxs)(s.li,{children:["Control 15: ",(0,t.jsx)(s.a,{href:"https://github.com/Redback-Operations/redback-cyber/blob/main/T1_2025/Email%20Infrastructure%20%26%20Security/Set-MFAEnforcement-AllUsers-Phase5.ps1",children:"Set-MFAEnforcement-AllUsers-Phase5.ps1"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"Control #"}),(0,t.jsx)(s.th,{children:"Control Name"}),(0,t.jsx)(s.th,{children:"Control Description"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"12"}),(0,t.jsx)(s.td,{children:"Block Malicious Senders and Domains"}),(0,t.jsx)(s.td,{children:"Block emails from known malicious sender addresses and domains."})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"13"}),(0,t.jsx)(s.td,{children:"Block Malicious IP Addresses"}),(0,t.jsx)(s.td,{children:"Block threat IPs using the Exchange Online connection filter policy."})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"14"}),(0,t.jsx)(s.td,{children:"Enable Email Activity Auditing and Logging"}),(0,t.jsx)(s.td,{children:"Enable mailbox-level auditing for visibility and traceability of email activity."})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"15"}),(0,t.jsx)(s.td,{children:"Enforce MFA"}),(0,t.jsx)(s.td,{children:"Require multi-factor authentication for all user accounts (excluding breakglass)."})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"16"}),(0,t.jsx)(s.td,{children:"Enforce MTA-STS"}),(0,t.jsx)(s.td,{children:"Enforce strict TLS encryption using MTA-STS and TLS-RPT policy."})]})]})]}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h2,{id:"important-notes",children:"Important Notes"}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.strong,{children:"For controls 12, 13, and 14:"})}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Installed the ExchangeOnlineManagement PowerShell module"}),"\n",(0,t.jsx)(s.li,{children:"Set execution policy to \u2018Bypass\u2019 for the current session"}),"\n",(0,t.jsx)(s.li,{children:"Imported the ExchangeOnlineManagement PowerShell module"}),"\n",(0,t.jsx)(s.li,{children:"Connected using an account with 'Global Administrator', 'Exchange Administrator' or \u2018Security Administrator\u2019 permissions"}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"Exchange Online PowerShell",src:i(74538).A+"",width:"1149",height:"256"})}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.strong,{children:"For control 15:"})}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Installed Microsoft Graph SDK PowerShell module"}),"\n",(0,t.jsx)(s.li,{children:"Set execution policy to \u2018Bypass\u2019 for the current session"}),"\n",(0,t.jsx)(s.li,{children:"Imported the required Microsoft Graph SDK PowerShell module"}),"\n",(0,t.jsx)(s.li,{children:"Connected using an account with 'Global Administrator' permission with the required scope"}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"Microsoft Graph PowerShell",src:i(25387).A+"",width:"1052",height:"346"})}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h2,{id:"12-block-emails-from-malicious-senders-and-sender-domains-via-mail-flow-rule",children:"12. Block Emails from Malicious Senders and Sender Domains (via Mail Flow Rule)"}),"\n",(0,t.jsx)(s.h3,{id:"121-implement",children:"12.1. IMPLEMENT"}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"12.1",src:i(51439).A+"",width:"1155",height:"561"})}),"\n",(0,t.jsx)(s.h3,{id:"122-validate",children:"12.2. VALIDATE"}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.img,{alt:"12.2.1",src:i(27376).A+"",width:"1129",height:"225"}),(0,t.jsx)(s.br,{}),"\n",(0,t.jsx)(s.img,{alt:"12.2.2",src:i(83943).A+"",width:"1187",height:"744"}),(0,t.jsx)(s.br,{}),"\n",(0,t.jsx)(s.img,{alt:"12.2.3",src:i(28).A+"",width:"1290",height:"867"})]}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h2,{id:"13-block-emails-from-malicious-ip-addresses-via-connection-filtering-policy",children:"13. Block Emails from Malicious IP Addresses (via Connection Filtering Policy)"}),"\n",(0,t.jsx)(s.h3,{id:"131-implement",children:"13.1. IMPLEMENT"}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"13.1",src:i(45053).A+"",width:"1116",height:"216"})}),"\n",(0,t.jsx)(s.h3,{id:"132-validate",children:"13.2. VALIDATE"}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.img,{alt:"13.2.1",src:i(69796).A+"",width:"1110",height:"506"}),(0,t.jsx)(s.br,{}),"\n",(0,t.jsx)(s.img,{alt:"13.2.2",src:i(48117).A+"",width:"1055",height:"884"})]}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h2,{id:"14-enable-email-activity-logging-and-auditing-for-all-mailboxes",children:"14. Enable Email Activity Logging and Auditing for all Mailboxes"}),"\n",(0,t.jsx)(s.h3,{id:"141-implement",children:"14.1. IMPLEMENT"}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"14.1",src:i(54720).A+"",width:"490",height:"178"})}),"\n",(0,t.jsx)(s.h3,{id:"142-validate",children:"14.2. VALIDATE"}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"14.2",src:i(52272).A+"",width:"1065",height:"539"})}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h2,{id:"15-enforce-multi-factor-authentication-mfa",children:"15. Enforce Multi-Factor Authentication (MFA)"}),"\n",(0,t.jsx)(s.h3,{id:"151-implement",children:"15.1. IMPLEMENT"}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"15.1",src:i(22212).A+"",width:"1590",height:"588"})}),"\n",(0,t.jsx)(s.h3,{id:"152-validate",children:"15.2. VALIDATE"}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.img,{alt:"15.2.1",src:i(66195).A+"",width:"1158",height:"458"}),(0,t.jsx)(s.br,{}),"\n",(0,t.jsx)(s.img,{alt:"15.2.2",src:i(27728).A+"",width:"1190",height:"525"}),(0,t.jsx)(s.br,{}),"\n",(0,t.jsx)(s.img,{alt:"15.2.3",src:i(2879).A+"",width:"835",height:"844"}),(0,t.jsx)(s.br,{}),"\n",(0,t.jsx)(s.img,{alt:"15.2.4",src:i(10338).A+"",width:"644",height:"754"}),(0,t.jsx)(s.br,{}),"\n",(0,t.jsx)(s.img,{alt:"15.2.5",src:i(72233).A+"",width:"843",height:"884"})]}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h2,{id:"16-enforce-strict-tls-encryption-via-mta-sts",children:"16. Enforce Strict TLS Encryption via MTA-STS"}),"\n",(0,t.jsx)(s.p,{children:"MTA-STS (Mail Transfer Agent Strict Transport Security) is an email security standard that ensures that:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Inbound emails to your domain are encrypted using TLS"}),"\n",(0,t.jsx)(s.li,{children:"Inbound emails are only sent to authorised mail servers (as specified in the MX record of your domain)"}),"\n"]}),"\n",(0,t.jsx)(s.h3,{id:"161-implement",children:"16.1. IMPLEMENT"}),"\n",(0,t.jsx)(s.h4,{id:"1611-host-mta-sts-policy-via-github-pages",children:"16.1.1. Host MTA-STS Policy via GitHub Pages"}),"\n",(0,t.jsx)(s.p,{children:"You should create a GitHub repo with the structure below:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-plaintext",children:"\ud83d\udcc1 redbackops-mta-sts-host/\r\n\u251c\u2500\u2500 \ud83d\udcc4 _config.yml \u2190 includes the .well-known directory\r\n\u2514\u2500\u2500 \ud83d\udcc2 .well-known/\r\n    \u2514\u2500\u2500 \ud83d\udcc4 mta-sts.txt \u2190 your actual MTA-STS policy file\n"})}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"16.1.1.1.\tCreate a GitHub Repo (Public)"}),(0,t.jsx)(s.br,{}),"\n","\u2022\t",(0,t.jsx)(s.strong,{children:"Name it"}),": ",(0,t.jsx)(s.code,{children:"redbackops-mta-sts-host"}),(0,t.jsx)(s.br,{}),"\n","\u2022\t",(0,t.jsx)(s.strong,{children:"Add a folder"}),": ",(0,t.jsx)(s.code,{children:".well-known/"}),(0,t.jsx)(s.br,{}),"\n","\u2022\tInside ",(0,t.jsx)(s.code,{children:".well-known/"}),", create a file named: ",(0,t.jsx)(s.code,{children:"mta-sts.txt"})]}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsxs)(s.strong,{children:["16.1.1.2.\tAdd MTA-STS policy to the ",(0,t.jsx)(s.code,{children:"mta-sts.txt"})," file"]})}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:"version: STSv1\r\nmode: enforce\r\nmx: *.mail.protection.outlook.com\r\nmax_age: 604800\n"})}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"16.1.1.2",src:i(10258).A+"",width:"726",height:"293"})}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"16.1.1.3.\tAdd a _config.yml file with the following content"}),(0,t.jsx)(s.br,{}),"\n",(0,t.jsx)(s.code,{children:'include: [".well-known"]'}),(0,t.jsx)(s.br,{}),"\n",(0,t.jsx)(s.img,{alt:"16.1.1.3",src:i(27820).A+"",width:"663",height:"273"})]}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"16.1.1.4. Enable GitHub Pages"}),(0,t.jsx)(s.br,{}),"\n","\u2022\tGo to ",(0,t.jsx)(s.strong,{children:"Settings -> Pages"}),(0,t.jsx)(s.br,{}),"\n","\u2022\tSelect the branch ",(0,t.jsx)(s.code,{children:"main"})," and ",(0,t.jsx)(s.code,{children:"root"}),(0,t.jsx)(s.br,{}),"\n","\u2022\t",(0,t.jsx)(s.strong,{children:"Custom domain"}),": ",(0,t.jsx)(s.code,{children:"mta-sts.redbackops.com"}),(0,t.jsx)(s.br,{}),"\n","\u2022\tThe policy will now be hosted at: ",(0,t.jsx)(s.code,{children:"https://mta-sts.redbackops.com/.well-known/mta-sts.txt"}),(0,t.jsx)(s.br,{}),"\n",(0,t.jsx)(s.img,{alt:"16.1.1.4",src:i(27488).A+"",width:"1008",height:"933"})]}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"16.1.1.5.\tThe policy will now be hosted at:"})," ",(0,t.jsx)(s.code,{children:"https://mta-sts.redbackops.com/.well-known/mta-sts.txt"}),(0,t.jsx)(s.br,{}),"\n",(0,t.jsx)(s.img,{alt:"16.1.1.5",src:i(54296).A+"",width:"473",height:"175"})]}),"\n",(0,t.jsx)(s.h4,{id:"1612-add-dns-records",children:"16.1.2. Add DNS Records"}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.strong,{children:"16.1.2.1.\tMap to GitHub custom subdomain"})}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:"Name: mta-sts.redbackops.com\r\nType: CNAME\r\nValue: <username>.github.io\n"})}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"16.1.2.1",src:i(39996).A+"",width:"943",height:"404"})}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.strong,{children:"16.1.2.2.\tAdd TXT record for _mta-sts"})}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:"Name: _mta-sts.redbackops.com\r\nType: TXT\r\nValue: v=STSv1; id=20250516T173050\n"})}),"\n",(0,t.jsxs)(s.blockquote,{children:["\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Note:"}),(0,t.jsx)(s.br,{}),"\n","The ",(0,t.jsx)(s.code,{children:"id"})," value is a timestamp string used by external mail servers to detect changes. In this case, id=20250516T173050, which can be interpreted as:",(0,t.jsx)(s.br,{}),"\n","\u2022\t",(0,t.jsx)(s.strong,{children:"Year"}),": 2025",(0,t.jsx)(s.br,{}),"\n","\u2022\t",(0,t.jsx)(s.strong,{children:"Month"}),": 05",(0,t.jsx)(s.br,{}),"\n","\u2022\t",(0,t.jsx)(s.strong,{children:"Day"}),": 16",(0,t.jsx)(s.br,{}),"\n","\u2022\t",(0,t.jsx)(s.strong,{children:"Hour"}),": 17",(0,t.jsx)(s.br,{}),"\n","\u2022\t",(0,t.jsx)(s.strong,{children:"Minute"}),": 30",(0,t.jsx)(s.br,{}),"\n","\u2022\t",(0,t.jsx)(s.strong,{children:"Second"}),": 50"]}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.strong,{children:"16.1.2.3.\tTXT record for TLS-RPT reporting"})}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:"Name: _smtp._tls.redbackops.com\r\nType: TXT\r\nValue: v=TLSRPTv1; rua=mailto:blueteam@redbackops.com\n"})}),"\n",(0,t.jsxs)(s.blockquote,{children:["\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Note:"}),(0,t.jsx)(s.br,{}),"\n","This enables daily TLS report aggregates from complaint mail providers (eg, Google, Microsoft, and Yahoo)"]}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"16.1.2.2",src:i(32765).A+"",width:"1050",height:"273"})}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h3,{id:"162-validate",children:"16.2. VALIDATE"}),"\n",(0,t.jsx)(s.h4,{id:"1621-using-command-line-tools-eg-nslookup",children:"16.2.1. Using Command Line Tools (e.g., nslookup)"}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"16.2.1.1.\tValidate DNS TXT record for _mta-sts"}),(0,t.jsx)(s.br,{}),"\n",(0,t.jsx)(s.code,{children:"nslookup -type=TXT _mta-sts.redbackops.com"}),(0,t.jsx)(s.br,{}),"\n",(0,t.jsx)(s.img,{alt:"16.2.1.1",src:i(85291).A+"",width:"508",height:"134"})]}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"16.2.1.2.\tValidate TXT record for TLS-RPT reporting"}),(0,t.jsx)(s.br,{}),"\n",(0,t.jsx)(s.code,{children:"nslookup -type=TXT _smtp._tls.redbackops.com"}),(0,t.jsx)(s.br,{}),"\n",(0,t.jsx)(s.img,{alt:"16.2.1.2",src:i(49851).A+"",width:"530",height:"137"})]}),"\n",(0,t.jsx)(s.h4,{id:"1622-using-online-tools-mxtoolbox-hardenize",children:"16.2.2. Using Online Tools (MXToolbox, Hardenize)"}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"16.2.2.1.\tValidate using MXToolbox"}),(0,t.jsx)(s.br,{}),"\n",(0,t.jsx)(s.img,{alt:"16.2.2.1.1",src:i(45427).A+"",width:"1325",height:"789"}),(0,t.jsx)(s.br,{}),"\n",(0,t.jsx)(s.img,{alt:"16.2.2.1.2",src:i(142).A+"",width:"1060",height:"878"})]}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"16.2.2.2.\tValidate using Hardenize"}),"\r\n",(0,t.jsx)(s.img,{alt:"16.2.2.2.1",src:i(15450).A+"",width:"1398",height:"988"}),(0,t.jsx)(s.br,{}),"\n",(0,t.jsx)(s.img,{alt:"16.2.2.2.2",src:i(72119).A+"",width:"1314",height:"985"})]}),"\n",(0,t.jsx)(s.h4,{id:"1623-test-email-delivery",children:"16.2.3. Test Email Delivery"}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsxs)(s.strong,{children:["16.2.3.1.\tSend a test e-mail from a Gmail sender address (eg, ",(0,t.jsx)(s.a,{href:"mailto:redbackops24@gmail.com",children:"redbackops24@gmail.com"}),") to a @redbackops.com email account."]}),(0,t.jsx)(s.br,{}),"\n",(0,t.jsx)(s.strong,{children:"16.2.3.2.\tCheck the e-mail headers."}),(0,t.jsx)(s.br,{}),"\n",(0,t.jsx)(s.img,{alt:"16.2.3.2",src:i(73905).A+"",width:"1093",height:"976"})]}),"\n",(0,t.jsx)(s.h4,{id:"16233-result--evidence-of-mta-sts-enforcement",children:"16.2.3.3. RESULT \u2013 Evidence of MTA-STS Enforcement"}),"\n",(0,t.jsx)(s.p,{children:"By design, there is no specific email header that directly shows that MTA-STS was applied because:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"MTA-STS is a transport-layer security mechanism"}),"\n",(0,t.jsx)(s.li,{children:"It applies during the SMTP handshake and is not recorded in email headers"}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"However, based on the screenshot above, it can be validated that MTA-STS was applied based on the points below:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Encryption (TLS 1.3) was used when Gmail delivered the email"}),"\n",(0,t.jsxs)(s.li,{children:["The receiving domain (redbackops.com) had:","\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["A valid ",(0,t.jsx)(s.code,{children:"_mta-sts.redbackops.com"})," TXT record"]}),"\n",(0,t.jsxs)(s.li,{children:["A reachable ",(0,t.jsx)(s.code,{children:"https://mta-sts.redbackops.com/.well-known/mta-sts.txt"})," file"]}),"\n",(0,t.jsx)(s.li,{children:"An MTA-STS policy in enforce mode"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(s.li,{children:"Senders like Gmail support and respect MTA-STS policy if one exists"}),"\n",(0,t.jsx)(s.li,{children:"If Gmail (as the sender) was unable to establish a secure TLS connection, or if the TLS certificate on the receiving server (redbackops.com) did not match the MTA-STS policy requirements, Gmail would have refused to deliver the email because redbackops.com\u2019s MTA-STS policy is set to enforce mode."}),"\n"]}),"\n",(0,t.jsx)(s.hr,{}),"\n",(0,t.jsx)(s.h2,{id:"references",children:"References"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"https://learn.microsoft.com/en-us/powershell/exchange/exchange-online-powershell?view=exchange-ps",children:"Microsoft Exchange PowerShell"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"https://learn.microsoft.com/en-us/powershell/microsoftgraph/?view=graph-powershell-1.0",children:"Microsoft Graph PowerShell SDK"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"https://mxtoolbox.com/dmarc/details/mta-sts/what-is-mta-sts-record",children:"MTA-STS Overview \u2013 MXToolbox"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"https://www.mailhardener.com/kb/mta-sts",children:"MTA-STS Knowledge Base \u2013 Mailhardener"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"https://github.com/jimeh/mta-sts-on-github-pages",children:"GitHub Pages Hosting Reference"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"https://mxtoolbox.com/mta-sts.aspx",children:"MTA-STS Lookup Tool \u2013 MXToolbox"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"https://www.hardenize.com/",children:"TLS and MTA-STS Reporting \u2013 Hardenize"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"https://github.com/Redback-Operations/redback-cyber/blob/main/T1_2025/Email%20Infrastructure%20%26%20Security/Set-MFAEnforcement-AllUsers-Phase5.ps1",children:"PowerShell Script \u2013 MFA Enforcement"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"https://github.com/Redback-Operations/redback-cyber/blob/main/T1_2025/Email%20Infrastructure%20%26%20Security/Set-MailflowSecurity-AuditControls-Phase5.ps1",children:"PowerShell Script \u2013 Mailflow & Audit Controls"})}),"\n"]})]})}function h(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}},74538:(e,s,i)=>{i.d(s,{A:()=>n});const n=i.p+"assets/images/12.0.1_exchange-online-ps-8cb27cf72a1d405ccc15c1c68b6ab320.jpg"},25387:(e,s,i)=>{i.d(s,{A:()=>n});const n=i.p+"assets/images/12.0.2_ms-graph-ps-3a93e4b615905c3f4809f9491b82a601.jpg"},51439:(e,s,i)=>{i.d(s,{A:()=>n});const n=i.p+"assets/images/12.1_implement-transport-rule-16b1e0a4372d7460942e816d1d5b347a.jpg"},27376:(e,s,i)=>{i.d(s,{A:()=>n});const n=i.p+"assets/images/12.2.1_validate-transport-rule-d7a1728d39a6897ef2b7bedf45f94eae.jpg"},83943:(e,s,i)=>{i.d(s,{A:()=>n});const n=i.p+"assets/images/12.2.2_validate-transport-rule-31eb9fff53e4ddc9f304414c6acabcf4.jpg"},28:(e,s,i)=>{i.d(s,{A:()=>n});const n=i.p+"assets/images/12.2.3_gui-validate-transport-rule-7109be2320174dbd5d828b3e252e62d8.jpg"},45053:(e,s,i)=>{i.d(s,{A:()=>n});const n=i.p+"assets/images/13.1_implement-block-ip-decfdaed2c58367478273560ef9094c3.jpg"},69796:(e,s,i)=>{i.d(s,{A:()=>n});const n=i.p+"assets/images/13.2.1_validate-block-ip-b5169eb74e660c9d8df5865de695782d.jpg"},48117:(e,s,i)=>{i.d(s,{A:()=>n});const n=i.p+"assets/images/13.2.2_gui-validate-block-ip-bb2305d19920e0ef923b7d745ce06da2.jpg"},54720:(e,s,i)=>{i.d(s,{A:()=>n});const n=i.p+"assets/images/14.1_implement-audit-enable-688fe049fa688319a6a90cec0c7b02e6.jpg"},52272:(e,s,i)=>{i.d(s,{A:()=>n});const n=i.p+"assets/images/14.2_validate-audit-enable-a38a64098b82852391ae22868b2d7b89.jpg"},22212:(e,s,i)=>{i.d(s,{A:()=>n});const n=i.p+"assets/images/15.1_implement-mfa-f086d73bb28c3f535f2deb93e6a3b125.jpg"},66195:(e,s,i)=>{i.d(s,{A:()=>n});const n=i.p+"assets/images/15.2.1_validate-mfa-1a78f2e3d3fcabba08e954d282c4692f.jpg"},27728:(e,s,i)=>{i.d(s,{A:()=>n});const n=i.p+"assets/images/15.2.2_gui-validate-mfa-ce2a07d41f71deb85374e0a13ee5d91d.jpg"},2879:(e,s,i)=>{i.d(s,{A:()=>n});const n=i.p+"assets/images/15.2.3_gui-validate-mfa-ddb98b0795cca76c93bf1cc452ad7228.jpg"},10338:(e,s,i)=>{i.d(s,{A:()=>n});const n=i.p+"assets/images/15.2.4_gui-validate-mfa-0bef0aef46e6ae71d39e5d1131fdac7f.jpg"},72233:(e,s,i)=>{i.d(s,{A:()=>n});const n=i.p+"assets/images/15.2.5_gui-validate-mfa-fc483e7bc8aed6faabceaf276c72a46b.jpg"},10258:(e,s,i)=>{i.d(s,{A:()=>n});const n=i.p+"assets/images/16.1.1.2_mta-sts-policy-4956636bc4ce8ae7f1aaadf512b94aee.jpg"},27820:(e,s,i)=>{i.d(s,{A:()=>n});const n=i.p+"assets/images/16.1.1.3_config-yml-e7891706d9a33b2d076e05ea1f09def6.jpg"},27488:(e,s,i)=>{i.d(s,{A:()=>n});const n=i.p+"assets/images/16.1.1.4_github-pages-a7f8da47fcdf1eecaed40f6bd0987cae.jpg"},54296:(e,s,i)=>{i.d(s,{A:()=>n});const n=i.p+"assets/images/16.1.1.5_verify-hosted-669e9fa7f9265e4f608552824dd9eb11.jpg"},39996:(e,s,i)=>{i.d(s,{A:()=>n});const n=i.p+"assets/images/16.1.2.1_dns-cname-github-c0738bdf0d71ffba16e404a3dedd65ce.jpg"},32765:(e,s,i)=>{i.d(s,{A:()=>n});const n=i.p+"assets/images/16.1.2.2_dns-cname-github-ce575abc5cbcf643a7d7c0ffbf4b07d9.jpg"},85291:(e,s,i)=>{i.d(s,{A:()=>n});const n=i.p+"assets/images/16.2.1.1_nslookup-mta-sts-b665dc346baeb3db5e05dfceb19d9694.jpg"},49851:(e,s,i)=>{i.d(s,{A:()=>n});const n=i.p+"assets/images/16.2.1.2_nslookup-tls-rpt-04c542bfed52216865b2a84dc268264e.jpg"},45427:(e,s,i)=>{i.d(s,{A:()=>n});const n=i.p+"assets/images/16.2.2.1.1_mxtoolbox-report-38aac11e132dc5ccd69e5288f9a32b3d.jpg"},142:(e,s,i)=>{i.d(s,{A:()=>n});const n=i.p+"assets/images/16.2.2.1.2_mxtoolbox-report-4c5d1c78907714ed150dfd2daf36dec7.jpg"},15450:(e,s,i)=>{i.d(s,{A:()=>n});const n=i.p+"assets/images/16.2.2.2.1_hardenize-report-5d2f2079bf4594c9aa9a9522bf2998ee.jpg"},72119:(e,s,i)=>{i.d(s,{A:()=>n});const n=i.p+"assets/images/16.2.2.2.2_hardenize-report-9773631226ff7ef154b32c49cfa73aab.jpg"},73905:(e,s,i)=>{i.d(s,{A:()=>n});const n=i.p+"assets/images/16.2.3.2_mta-sts-headers-591f2a95f53745681e63c26bd46c1816.jpg"},28453:(e,s,i)=>{i.d(s,{R:()=>a,x:()=>l});var n=i(96540);const t={},r=n.createContext(t);function a(e){const s=n.useContext(r);return n.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),n.createElement(r.Provider,{value:s},e.children)}}}]);